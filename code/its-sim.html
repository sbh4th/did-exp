<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ITS treatment considerations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="its-sim_files/libs/clipboard/clipboard.min.js"></script>
<script src="its-sim_files/libs/quarto-html/quarto.js"></script>
<script src="its-sim_files/libs/quarto-html/popper.min.js"></script>
<script src="its-sim_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="its-sim_files/libs/quarto-html/anchor.min.js"></script>
<link href="its-sim_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="its-sim_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="its-sim_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="its-sim_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="its-sim_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ITS treatment considerations</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(estimatr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tinytable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="data-setup" class="level2">
<h2 class="anchored" data-anchor-id="data-setup">Data setup</h2>
<p>First letâ€™s simulate some data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">48620</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># unit fixed effects (unobserved heterogeneity)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>unit <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate clusters</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit_fe =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, state<span class="sc">/</span><span class="dv">10</span>, <span class="dv">1</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate instantaneous treatment effect</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mu = rnorm(nobs, true_mu, 0.2)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="dv">2</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># year fixed effects (first part)</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2001</span><span class="sc">:</span><span class="dv">2020</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_fe =</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(year), <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Put the clusters into treatment groups</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>treat_taus <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample the clusters randomly</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">30</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># place the randomly sampled states into 1\{t \ge g \}G_g</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">cohort_year =</span> <span class="fu">sort</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2010</span>, <span class="dv">2015</span>), <span class="at">times=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>)))</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co"># make main dataset</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co"># full interaction of unit X year </span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>dtest <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">year =</span> <span class="dv">2001</span><span class="sc">:</span><span class="dv">2020</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., unit) <span class="sc">%&gt;%</span> </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., year) <span class="sc">%&gt;%</span> </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., treat_taus) <span class="sc">%&gt;%</span> </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make error term and get treatment indicators and treatment effects</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Also get cohort specific trends (modify time FE)</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">error =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span><span class="sc">*</span><span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat =</span> <span class="fu">ifelse</span>((year <span class="sc">&gt;=</span> </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>           cohort_year), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>         <span class="co"># treatment effect = 3 if 2015, 6 if 2010, annually</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">mu =</span> <span class="fu">ifelse</span>(cohort_year<span class="sc">==</span><span class="dv">2015</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">tau =</span> <span class="fu">ifelse</span>(treat <span class="sc">==</span> <span class="dv">1</span>, mu, <span class="dv">0</span>),</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>         <span class="co"># year trends differ by cohort</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_fe =</span> year_fe <span class="sc">+</span> (<span class="dv">2020</span> <span class="sc">-</span> cohort_year) <span class="sc">*</span> </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>           (year <span class="sc">-</span> cohort_year) <span class="sc">/</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">20</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate cumulative treatment effects</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(unit) <span class="sc">%&gt;%</span> </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tau_cum =</span> <span class="fu">cumsum</span>(tau)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the dependent variable</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> (<span class="dv">2020</span> <span class="sc">-</span> cohort_year) <span class="sc">+</span> </span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>           unit_fe <span class="sc">+</span> year_fe <span class="sc">+</span> tau_cum <span class="sc">+</span> error) </span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Relabel 2018 cohort as never-treated</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(cohort_year = ifelse(cohort_year == 2018, Inf, cohort_year))</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="co"># bring in simulated DiD dataset</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>ds <span class="ot">&lt;-</span> dtest <span class="sc">%&gt;%</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read_rds(here("data", </span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a> <span class="co">#"did-sim-data.rds")) %&gt;%</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year0 =</span> year <span class="sc">-</span> <span class="dv">2001</span>,</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">yearc =</span> year <span class="sc">-</span> cohort_year,</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">cohort_2015 =</span> <span class="fu">ifelse</span>(cohort_year <span class="sc">==</span> <span class="dv">2015</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is a plot of the simulated data, with the averages plotted for each cohort and the time of intervention marked on the graph.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="its-sim_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="group-specific-analysis" class="level2">
<h2 class="anchored" data-anchor-id="group-specific-analysis">Group-specific analysis</h2>
<p>What is the causal effect of the intervention in the 2010 cohort?</p>
<p>Letâ€™s do the ITS for the early treated cohort. First, letâ€™s estimate the models separately for each cohort. Weâ€™ll use the <code>lm_robust</code> function from <code>estimatr</code> to easily get cluster robust standard errors.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># models</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>m_c2010 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> year0 <span class="sc">*</span> treat, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">subset</span>(ds, cohort_year <span class="sc">==</span> <span class="dv">2010</span>), </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>m_c2015 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> year0 <span class="sc">*</span> treat, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">subset</span>(ds, cohort_year <span class="sc">==</span> <span class="dv">2015</span>), </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"2010 cohort"</span> <span class="ot">=</span> m_c2010,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"2015 cohort"</span> <span class="ot">=</span> m_c2015),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_2pw437uld38tfpdia68k(i, j, css_id) {
        var table = document.getElementById("tinytable_2pw437uld38tfpdia68k");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_2pw437uld38tfpdia68k');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_2pw437uld38tfpdia68k(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_2pw437uld38tfpdia68k");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(0, 0, 'tinytable_css_idknq583qs8poeitvplj09') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(0, 1, 'tinytable_css_id16tt9tmwqrt7g794xaqo') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(0, 2, 'tinytable_css_id16tt9tmwqrt7g794xaqo') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(1, 0, 'tinytable_css_idfpcbvkfc2d95i59jk1b9') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(1, 1, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(1, 2, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(2, 0, 'tinytable_css_idfpcbvkfc2d95i59jk1b9') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(2, 1, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(2, 2, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(3, 0, 'tinytable_css_idfpcbvkfc2d95i59jk1b9') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(3, 1, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(3, 2, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(4, 0, 'tinytable_css_idfpcbvkfc2d95i59jk1b9') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(4, 1, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(4, 2, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(5, 0, 'tinytable_css_idfpcbvkfc2d95i59jk1b9') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(5, 1, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(5, 2, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(6, 0, 'tinytable_css_idfpcbvkfc2d95i59jk1b9') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(6, 1, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(6, 2, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(7, 0, 'tinytable_css_idfpcbvkfc2d95i59jk1b9') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(7, 1, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(7, 2, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(8, 0, 'tinytable_css_id7gkxt1vsruxir173vol2') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(8, 1, 'tinytable_css_idcy0njc14rfv36233l3xa') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(8, 2, 'tinytable_css_idcy0njc14rfv36233l3xa') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(9, 0, 'tinytable_css_idfpcbvkfc2d95i59jk1b9') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(9, 1, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(9, 2, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(10, 0, 'tinytable_css_idfpcbvkfc2d95i59jk1b9') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(10, 1, 'tinytable_css_idguz3jebneeanbsbdzakj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(10, 2, 'tinytable_css_idguz3jebneeanbsbdzakj') })
    </script>

    <style>
    .table td.tinytable_css_idknq583qs8poeitvplj09, .table th.tinytable_css_idknq583qs8poeitvplj09 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id16tt9tmwqrt7g794xaqo, .table th.tinytable_css_id16tt9tmwqrt7g794xaqo {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idfpcbvkfc2d95i59jk1b9, .table th.tinytable_css_idfpcbvkfc2d95i59jk1b9 {  text-align: left; }
    .table td.tinytable_css_idguz3jebneeanbsbdzakj, .table th.tinytable_css_idguz3jebneeanbsbdzakj {  text-align: center; }
    .table td.tinytable_css_id7gkxt1vsruxir173vol2, .table th.tinytable_css_id7gkxt1vsruxir173vol2 {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idcy0njc14rfv36233l3xa, .table th.tinytable_css_idcy0njc14rfv36233l3xa {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_2pw437uld38tfpdia68k" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">2010 cohort</th>
                <th scope="col">2015 cohort</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)  </td>
                  <td>12.97    </td>
                  <td>12.04    </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.28)   </td>
                  <td>(0.22)   </td>
                </tr>
                <tr>
                  <td>year0        </td>
                  <td>2.03     </td>
                  <td>1.09     </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.01)   </td>
                  <td>(0.00)   </td>
                </tr>
                <tr>
                  <td>treat        </td>
                  <td>-6.44    </td>
                  <td>-25.92   </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.12)   </td>
                  <td>(0.36)   </td>
                </tr>
                <tr>
                  <td>year0 Ã— treat</td>
                  <td>0.92     </td>
                  <td>1.95     </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.01)   </td>
                  <td>(0.02)   </td>
                </tr>
                <tr>
                  <td>Num.Obs.     </td>
                  <td>6520     </td>
                  <td>13480    </td>
                </tr>
                <tr>
                  <td>Std.Errors   </td>
                  <td>by: state</td>
                  <td>by: state</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>The slope estimates are basically what we specified in the simulation (1 for the 2010 cohort and 2 for the 2015 cohort). Now letâ€™s estimate the effect of the intervention at the end of follow-up, setting <code>year0=19</code> and estimate the difference by treatment status, using the <code>marginaleffects</code> package. Weâ€™ll estimate the average predictions under each treatment regime and then estimate the difference.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions for 2010 cohort</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>p_2010 <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_c2010, <span class="at">variables =</span> <span class="st">"treat"</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>d_2010 <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(m_c2010, <span class="at">variables =</span> <span class="st">"treat"</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>p_2010<span class="sc">$</span>term <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Untreated"</span>, <span class="st">"Treated"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>d_2010<span class="sc">$</span>term <span class="ot">=</span> <span class="st">"Difference"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>p_2010 <span class="ot">&lt;-</span> p_2010 <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(d_2010)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions for 2015 cohort</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>p_2015 <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_c2015, <span class="at">variables =</span> <span class="st">"treat"</span>, </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>))</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>d_2015 <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(m_c2015, <span class="at">variables =</span> <span class="st">"treat"</span>, </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>p_2015<span class="sc">$</span>term <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Untreated"</span>, <span class="st">"Treated"</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>d_2015<span class="sc">$</span>term <span class="ot">=</span> <span class="st">"Difference"</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>p_2015 <span class="ot">&lt;-</span> p_2015 <span class="sc">%&gt;%</span> </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(d_2015)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"2010 cohort"</span> <span class="ot">=</span> p_2010,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2015 cohort"</span> <span class="ot">=</span> p_2015), <span class="at">fmt=</span><span class="dv">2</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_1cwd8lcwpzjifmdhxi1o(i, j, css_id) {
        var table = document.getElementById("tinytable_1cwd8lcwpzjifmdhxi1o");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_1cwd8lcwpzjifmdhxi1o');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_1cwd8lcwpzjifmdhxi1o(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_1cwd8lcwpzjifmdhxi1o");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(0, 0, 'tinytable_css_idhy4kt1hdtrhcg0mke2se') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(0, 1, 'tinytable_css_id83kqp0gpv0mgg5x8zamf') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(0, 2, 'tinytable_css_id83kqp0gpv0mgg5x8zamf') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(1, 0, 'tinytable_css_idq0u4uaxigx5tei8w19b9') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(1, 1, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(1, 2, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(2, 0, 'tinytable_css_idq0u4uaxigx5tei8w19b9') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(2, 1, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(2, 2, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(3, 0, 'tinytable_css_idq0u4uaxigx5tei8w19b9') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(3, 1, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(3, 2, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(4, 0, 'tinytable_css_idq0u4uaxigx5tei8w19b9') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(4, 1, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(4, 2, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(5, 0, 'tinytable_css_idq0u4uaxigx5tei8w19b9') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(5, 1, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(5, 2, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(6, 0, 'tinytable_css_idgmkkigbckcm5lqhahtg5') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(6, 1, 'tinytable_css_idmx743mak6h9lb3zhmilu') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(6, 2, 'tinytable_css_idmx743mak6h9lb3zhmilu') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(7, 0, 'tinytable_css_idq0u4uaxigx5tei8w19b9') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(7, 1, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(7, 2, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(8, 0, 'tinytable_css_idq0u4uaxigx5tei8w19b9') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(8, 1, 'tinytable_css_id60kla94tstpbuibflgut') })
window.addEventListener('load', function () { styleCell_1cwd8lcwpzjifmdhxi1o(8, 2, 'tinytable_css_id60kla94tstpbuibflgut') })
    </script>

    <style>
    .table td.tinytable_css_idhy4kt1hdtrhcg0mke2se, .table th.tinytable_css_idhy4kt1hdtrhcg0mke2se {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id83kqp0gpv0mgg5x8zamf, .table th.tinytable_css_id83kqp0gpv0mgg5x8zamf {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idq0u4uaxigx5tei8w19b9, .table th.tinytable_css_idq0u4uaxigx5tei8w19b9 {  text-align: left; }
    .table td.tinytable_css_id60kla94tstpbuibflgut, .table th.tinytable_css_id60kla94tstpbuibflgut {  text-align: center; }
    .table td.tinytable_css_idgmkkigbckcm5lqhahtg5, .table th.tinytable_css_idgmkkigbckcm5lqhahtg5 {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idmx743mak6h9lb3zhmilu, .table th.tinytable_css_idmx743mak6h9lb3zhmilu {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_1cwd8lcwpzjifmdhxi1o" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">2010 cohort</th>
                <th scope="col">2015 cohort</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Untreated </td>
                  <td>51.48    </td>
                  <td>32.82    </td>
                </tr>
                <tr>
                  <td>          </td>
                  <td>(0.31)   </td>
                  <td>(0.23)   </td>
                </tr>
                <tr>
                  <td>Treated   </td>
                  <td>62.44    </td>
                  <td>43.95    </td>
                </tr>
                <tr>
                  <td>          </td>
                  <td>(0.28)   </td>
                  <td>(0.21)   </td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>10.97    </td>
                  <td>11.13    </td>
                </tr>
                <tr>
                  <td>          </td>
                  <td>(0.18)   </td>
                  <td>(0.08)   </td>
                </tr>
                <tr>
                  <td>Num.Obs.  </td>
                  <td>6520     </td>
                  <td>13480    </td>
                </tr>
                <tr>
                  <td>Std.Errors</td>
                  <td>by: state</td>
                  <td>by: state</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>So, we get predictions of 62.4 under treatment and 51.5 in the counterfactual absence of treatment. The difference is 11. For the 2015 later-treated cohort, at the end of follow-up we get predictions of 43.9 under treatment and 32.8 in the counterfactual absence of treatment. The difference is 11.1. If we wanted to ignore the heterogeneity and just calculate an average causal effect at the end of follow-up, we can just take a weighted average of the cohort-specific effects.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>te <span class="ot">&lt;-</span> p_2010<span class="sc">$</span>estimate[<span class="dv">3</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> p_2015<span class="sc">$</span>estimate[<span class="dv">3</span>]<span class="sc">*</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The average causal effect in the population is 11.08.</p>
<p>In each of these cases it is clear that we are comparing each treated unit to itself to generate these counterfactual estimates. We can also use <code>marginaleffects</code> to get the average annual slopes (though redundant since these are linear models)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment slope for 2010 cohort</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>as_2010 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_c2010, <span class="at">variables =</span> <span class="st">"year0"</span>, <span class="at">by=</span><span class="st">"treat"</span>, <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Avg. slope"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># now for 2015 cohort</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>as_2015 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_c2015, <span class="at">variables =</span> <span class="st">"year0"</span>, <span class="at">by=</span><span class="st">"treat"</span>, <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Avg. slope"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"2010 cohort"</span> <span class="ot">=</span> as_2010,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2015 cohort"</span> <span class="ot">=</span> as_2015), <span class="at">fmt=</span><span class="dv">2</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_cqj8hxveo80egcs53z4w(i, j, css_id) {
        var table = document.getElementById("tinytable_cqj8hxveo80egcs53z4w");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_cqj8hxveo80egcs53z4w');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_cqj8hxveo80egcs53z4w(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_cqj8hxveo80egcs53z4w");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_cqj8hxveo80egcs53z4w(0, 0, 'tinytable_css_iduuu0rtcu4nxow72184q2') })
window.addEventListener('load', function () { styleCell_cqj8hxveo80egcs53z4w(0, 1, 'tinytable_css_idwiela9shrh7p3xacxmny') })
window.addEventListener('load', function () { styleCell_cqj8hxveo80egcs53z4w(0, 2, 'tinytable_css_idwiela9shrh7p3xacxmny') })
window.addEventListener('load', function () { styleCell_cqj8hxveo80egcs53z4w(1, 0, 'tinytable_css_idv0whs0jrw9mccvlt68l2') })
window.addEventListener('load', function () { styleCell_cqj8hxveo80egcs53z4w(1, 1, 'tinytable_css_idl6uro2ur2bkaj7w5mxur') })
window.addEventListener('load', function () { styleCell_cqj8hxveo80egcs53z4w(1, 2, 'tinytable_css_idl6uro2ur2bkaj7w5mxur') })
window.addEventListener('load', function () { styleCell_cqj8hxveo80egcs53z4w(2, 0, 'tinytable_css_idv0whs0jrw9mccvlt68l2') })
window.addEventListener('load', function () { styleCell_cqj8hxveo80egcs53z4w(2, 1, 'tinytable_css_idl6uro2ur2bkaj7w5mxur') })
window.addEventListener('load', function () { styleCell_cqj8hxveo80egcs53z4w(2, 2, 'tinytable_css_idl6uro2ur2bkaj7w5mxur') })
    </script>

    <style>
    .table td.tinytable_css_iduuu0rtcu4nxow72184q2, .table th.tinytable_css_iduuu0rtcu4nxow72184q2 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idwiela9shrh7p3xacxmny, .table th.tinytable_css_idwiela9shrh7p3xacxmny {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idv0whs0jrw9mccvlt68l2, .table th.tinytable_css_idv0whs0jrw9mccvlt68l2 {  text-align: left; }
    .table td.tinytable_css_idl6uro2ur2bkaj7w5mxur, .table th.tinytable_css_idl6uro2ur2bkaj7w5mxur {  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_cqj8hxveo80egcs53z4w" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">2010 cohort</th>
                <th scope="col">2015 cohort</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Avg. slope</td>
                  <td>0.92  </td>
                  <td>1.95  </td>
                </tr>
                <tr>
                  <td>          </td>
                  <td>(0.01)</td>
                  <td>(0.02)</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Same values as shown for the <code>year0 x treat</code> variable in the table of model estimates above. Although we fit these models separately, we could hand calculate an overall averaged effect (ignoring cohort heterogeneity). The 2015 cohort is twice as large as the 2010 cohort, so a weighted average of the average treatment slopes above is (1/3) * 0.92 + (2/3) * 1.95, which is about 1.61.</p>
</section>
<section id="pooled-analysis-with-calendar-time" class="level2">
<h2 class="anchored" data-anchor-id="pooled-analysis-with-calendar-time">Pooled analysis with calendar time</h2>
<p>Including a fixed effect for cohort in these models will only allow for an overall level shift, and if we include a product term between cohort and time, and cohort and the product term, we can recover the causal effects in both cohorts, or averaged over the entire period. Here are the model estimates:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>m_all <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(<span class="at">formula =</span> y <span class="sc">~</span> year0 <span class="sc">*</span> treat, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ds, <span class="at">clusters =</span> state)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>m_all_s <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(<span class="at">formula =</span> y <span class="sc">~</span> cohort_2015 <span class="sc">+</span> year0 <span class="sc">*</span> treat, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ds, <span class="at">clusters =</span> state)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>m_all_int <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(<span class="at">formula =</span> y <span class="sc">~</span> cohort_2015 <span class="sc">*</span> year0 <span class="sc">*</span> treat, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ds, <span class="at">clusters =</span> state)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"No cohort"</span> <span class="ot">=</span> m_all,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cohort FE"</span> <span class="ot">=</span> m_all_s, <span class="st">"Interactive"</span> <span class="ot">=</span> m_all_int),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_pl1f076zgy37blgp591r(i, j, css_id) {
        var table = document.getElementById("tinytable_pl1f076zgy37blgp591r");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_pl1f076zgy37blgp591r');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_pl1f076zgy37blgp591r(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_pl1f076zgy37blgp591r");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(0, 0, 'tinytable_css_idyroklgyfczudv5vuhc1h') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(0, 1, 'tinytable_css_idojfn5v95fwaw3jwjgpzg') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(0, 2, 'tinytable_css_idojfn5v95fwaw3jwjgpzg') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(0, 3, 'tinytable_css_idojfn5v95fwaw3jwjgpzg') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(1, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(1, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(1, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(1, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(2, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(2, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(2, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(2, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(3, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(3, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(3, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(3, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(4, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(4, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(4, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(4, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(5, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(5, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(5, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(5, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(6, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(6, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(6, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(6, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(7, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(7, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(7, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(7, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(8, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(8, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(8, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(8, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(9, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(9, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(9, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(9, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(10, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(10, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(10, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(10, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(11, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(11, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(11, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(11, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(12, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(12, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(12, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(12, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(13, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(13, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(13, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(13, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(14, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(14, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(14, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(14, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(15, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(15, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(15, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(15, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(16, 0, 'tinytable_css_idzik7unqghheyctuhp2pd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(16, 1, 'tinytable_css_idwckwfigaavu79zr4mn4f') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(16, 2, 'tinytable_css_idwckwfigaavu79zr4mn4f') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(16, 3, 'tinytable_css_idwckwfigaavu79zr4mn4f') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(17, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(17, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(17, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(17, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(18, 0, 'tinytable_css_idk5yxs32rvogh2fjw8fwd') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(18, 1, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(18, 2, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
window.addEventListener('load', function () { styleCell_pl1f076zgy37blgp591r(18, 3, 'tinytable_css_idbz9hdetpzimpd8lwsw01') })
    </script>

    <style>
    .table td.tinytable_css_idyroklgyfczudv5vuhc1h, .table th.tinytable_css_idyroklgyfczudv5vuhc1h {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idojfn5v95fwaw3jwjgpzg, .table th.tinytable_css_idojfn5v95fwaw3jwjgpzg {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idk5yxs32rvogh2fjw8fwd, .table th.tinytable_css_idk5yxs32rvogh2fjw8fwd {  text-align: left; }
    .table td.tinytable_css_idbz9hdetpzimpd8lwsw01, .table th.tinytable_css_idbz9hdetpzimpd8lwsw01 {  text-align: center; }
    .table td.tinytable_css_idzik7unqghheyctuhp2pd, .table th.tinytable_css_idzik7unqghheyctuhp2pd {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idwckwfigaavu79zr4mn4f, .table th.tinytable_css_idwckwfigaavu79zr4mn4f {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_pl1f076zgy37blgp591r" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">No cohort</th>
                <th scope="col">Cohort FE</th>
                <th scope="col">Interactive</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)                </td>
                  <td>13.39    </td>
                  <td>19.72    </td>
                  <td>12.97    </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>(0.36)   </td>
                  <td>(1.00)   </td>
                  <td>(0.28)   </td>
                </tr>
                <tr>
                  <td>year0                      </td>
                  <td>1.05     </td>
                  <td>1.38     </td>
                  <td>2.03     </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>(0.01)   </td>
                  <td>(0.07)   </td>
                  <td>(0.01)   </td>
                </tr>
                <tr>
                  <td>treat                      </td>
                  <td>5.83     </td>
                  <td>-8.00    </td>
                  <td>-6.44    </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>(0.56)   </td>
                  <td>(1.10)   </td>
                  <td>(0.12)   </td>
                </tr>
                <tr>
                  <td>year0 Ã— treat              </td>
                  <td>0.41     </td>
                  <td>0.95     </td>
                  <td>0.92     </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>(0.10)   </td>
                  <td>(0.05)   </td>
                  <td>(0.01)   </td>
                </tr>
                <tr>
                  <td>cohort_2015                </td>
                  <td>         </td>
                  <td>-10.81   </td>
                  <td>-0.93    </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>         </td>
                  <td>(0.39)   </td>
                  <td>(0.36)   </td>
                </tr>
                <tr>
                  <td>cohort_2015 Ã— year0        </td>
                  <td>         </td>
                  <td>         </td>
                  <td>-0.93    </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>         </td>
                  <td>         </td>
                  <td>(0.01)   </td>
                </tr>
                <tr>
                  <td>cohort_2015 Ã— treat        </td>
                  <td>         </td>
                  <td>         </td>
                  <td>-19.48   </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>         </td>
                  <td>         </td>
                  <td>(0.38)   </td>
                </tr>
                <tr>
                  <td>cohort_2015 Ã— year0 Ã— treat</td>
                  <td>         </td>
                  <td>         </td>
                  <td>1.03     </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>         </td>
                  <td>         </td>
                  <td>(0.02)   </td>
                </tr>
                <tr>
                  <td>Num.Obs.                   </td>
                  <td>20000    </td>
                  <td>20000    </td>
                  <td>20000    </td>
                </tr>
                <tr>
                  <td>Std.Errors                 </td>
                  <td>by: state</td>
                  <td>by: state</td>
                  <td>by: state</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>If we use the interacted model we can recover the cohort-specific treatment effects at the end of follow-up above (again, setting <code>year0</code> to 19), as well as getting an overall average (although we probably wouldnâ€™t want to ignore this kind of heterogeneity).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions at end of follow-up by treatment</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>m_all_int_ap <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_all_int, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>), </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment effects</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>m_all_int_te <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_all_int, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>), </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="fu">c</span>(<span class="st">"b2 - b1 = 0"</span>, <span class="st">"b4 - b3 = 0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"2010 cohort"</span>, <span class="st">"2015 cohort"</span>))</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Marginal effects from interaction model"</span> </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                  <span class="ot">=</span> m_all_int_te), <span class="at">fmt=</span><span class="dv">2</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"conf.int"</span>, <span class="at">shape =</span> term <span class="sc">~</span> statistic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_8zx9okuosndmhd5iwxi9(i, j, css_id) {
        var table = document.getElementById("tinytable_8zx9okuosndmhd5iwxi9");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_8zx9okuosndmhd5iwxi9');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_8zx9okuosndmhd5iwxi9(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_8zx9okuosndmhd5iwxi9");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(0, 0, 'tinytable_css_idnga4x14i2r4kl1lzwst6') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(0, 1, 'tinytable_css_id6rzfdv9we8e1nrawnjwk') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(0, 2, 'tinytable_css_id4pohmgqbvrn5q977i0vf') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(0, 3, 'tinytable_css_id4pohmgqbvrn5q977i0vf') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(1, 0, 'tinytable_css_id7cmkm0wxd8shb88693pi') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(1, 1, 'tinytable_css_idgh1eapdvww1rtpoqo24w') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(1, 2, 'tinytable_css_idgh1eapdvww1rtpoqo24w') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(1, 3, 'tinytable_css_idgh1eapdvww1rtpoqo24w') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(2, 0, 'tinytable_css_idmeb1xfqtp0h75z2nasqp') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(2, 1, 'tinytable_css_id4pohmgqbvrn5q977i0vf') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(2, 2, 'tinytable_css_id4pohmgqbvrn5q977i0vf') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(2, 3, 'tinytable_css_id4pohmgqbvrn5q977i0vf') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(3, 0, 'tinytable_css_idmeb1xfqtp0h75z2nasqp') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(3, 1, 'tinytable_css_id4pohmgqbvrn5q977i0vf') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(3, 2, 'tinytable_css_id4pohmgqbvrn5q977i0vf') })
window.addEventListener('load', function () { styleCell_8zx9okuosndmhd5iwxi9(3, 3, 'tinytable_css_id4pohmgqbvrn5q977i0vf') })
    </script>

    <style>
    .table td.tinytable_css_idnga4x14i2r4kl1lzwst6, .table th.tinytable_css_idnga4x14i2r4kl1lzwst6 {  text-align: center;  text-align: left; }
    .table td.tinytable_css_id6rzfdv9we8e1nrawnjwk, .table th.tinytable_css_id6rzfdv9we8e1nrawnjwk {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_id4pohmgqbvrn5q977i0vf, .table th.tinytable_css_id4pohmgqbvrn5q977i0vf {  text-align: center; }
    .table td.tinytable_css_id7cmkm0wxd8shb88693pi, .table th.tinytable_css_id7cmkm0wxd8shb88693pi {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idgh1eapdvww1rtpoqo24w, .table th.tinytable_css_idgh1eapdvww1rtpoqo24w {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idmeb1xfqtp0h75z2nasqp, .table th.tinytable_css_idmeb1xfqtp0h75z2nasqp {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_8zx9okuosndmhd5iwxi9" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Marginal effects from interaction model</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>2010 cohort</td>
                  <td>10.97</td>
                  <td>10.61</td>
                  <td>11.32</td>
                </tr>
                <tr>
                  <td>2015 cohort</td>
                  <td>11.13</td>
                  <td>10.98</td>
                  <td>11.28</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Same estimates that we calculated in the separate models above. Now for the average slopes:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># average slopes by treatment status</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>m_all_int_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_int, <span class="at">variable =</span> <span class="st">"year0"</span>, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>, <span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># average slope effects</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>m_all_int_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_int, <span class="at">variable =</span> <span class="st">"year0"</span>, </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="fu">c</span>(<span class="st">"b2 - b1 = 0"</span>, <span class="st">"b4 - b3 = 0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Difference"</span>, <span class="st">"Difference"</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">cohort_2015 =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>m_all_int_slopes <span class="ot">&lt;-</span> m_all_int_as <span class="sc">%&gt;%</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_int_slope) <span class="sc">%&gt;%</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cohort_2015 =</span> <span class="fu">factor</span>(cohort_2015,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"2010 cohort"</span>,<span class="st">"2015 cohort"</span>)))</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Average slopes: Interaction model"</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                  <span class="ot">=</span> m_all_int_slopes),</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> cohort_2015 <span class="sc">+</span> statistic,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_v8eshel9cxvgk1i0uvjf(i, j, css_id) {
        var table = document.getElementById("tinytable_v8eshel9cxvgk1i0uvjf");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_v8eshel9cxvgk1i0uvjf');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_v8eshel9cxvgk1i0uvjf(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_v8eshel9cxvgk1i0uvjf");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(0, 0, 'tinytable_css_ide9cmq20iaxg6e5icdgow') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(0, 1, 'tinytable_css_idc1siarkvlyjhgti5z68m') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(0, 2, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(0, 3, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(0, 4, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(0, 5, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(0, 6, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(1, 0, 'tinytable_css_ide9cmq20iaxg6e5icdgow') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(1, 1, 'tinytable_css_idc1siarkvlyjhgti5z68m') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(1, 2, 'tinytable_css_idc1siarkvlyjhgti5z68m') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(1, 3, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(1, 4, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(1, 5, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(1, 6, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(2, 0, 'tinytable_css_id355s7txnkpxs7xj2n8gp') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(2, 1, 'tinytable_css_idvq48542rtcfj1kgx9skr') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(2, 2, 'tinytable_css_idvq48542rtcfj1kgx9skr') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(2, 3, 'tinytable_css_idvq48542rtcfj1kgx9skr') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(2, 4, 'tinytable_css_idvq48542rtcfj1kgx9skr') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(2, 5, 'tinytable_css_idvq48542rtcfj1kgx9skr') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(2, 6, 'tinytable_css_idvq48542rtcfj1kgx9skr') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(3, 0, 'tinytable_css_id54o3xj483k5e0tilc4u9') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(3, 1, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(3, 2, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(3, 3, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(3, 4, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(3, 5, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(3, 6, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(4, 0, 'tinytable_css_id54o3xj483k5e0tilc4u9') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(4, 1, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(4, 2, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(4, 3, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(4, 4, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(4, 5, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(4, 6, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(5, 0, 'tinytable_css_id54o3xj483k5e0tilc4u9') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(5, 1, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(5, 2, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(5, 3, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(5, 4, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(5, 5, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
window.addEventListener('load', function () { styleCell_v8eshel9cxvgk1i0uvjf(5, 6, 'tinytable_css_id7tjxu7xsrp7ag9fj00nq') })
    </script>

    <style>
    .table td.tinytable_css_ide9cmq20iaxg6e5icdgow, .table th.tinytable_css_ide9cmq20iaxg6e5icdgow {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idc1siarkvlyjhgti5z68m, .table th.tinytable_css_idc1siarkvlyjhgti5z68m {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_id7tjxu7xsrp7ag9fj00nq, .table th.tinytable_css_id7tjxu7xsrp7ag9fj00nq {  text-align: center; }
    .table td.tinytable_css_id355s7txnkpxs7xj2n8gp, .table th.tinytable_css_id355s7txnkpxs7xj2n8gp {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idvq48542rtcfj1kgx9skr, .table th.tinytable_css_idvq48542rtcfj1kgx9skr {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id54o3xj483k5e0tilc4u9, .table th.tinytable_css_id54o3xj483k5e0tilc4u9 {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_v8eshel9cxvgk1i0uvjf" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="6">Average slopes: Interaction model</th>
</tr>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">2010 cohort</th>
<th scope="col" align="center" colspan="3">2015 cohort</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Pre       </td>
                  <td>2.03</td>
                  <td>2.00</td>
                  <td>2.05</td>
                  <td>1.09</td>
                  <td>1.08</td>
                  <td>1.10</td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td>2.94</td>
                  <td>2.93</td>
                  <td>2.96</td>
                  <td>3.04</td>
                  <td>3.00</td>
                  <td>3.09</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>0.92</td>
                  <td>0.89</td>
                  <td>0.94</td>
                  <td>1.95</td>
                  <td>1.91</td>
                  <td>1.99</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Again, same as above.</p>
<p>As noted above, since the 2015 cohort is twice as large as the 2010 cohort, if we wanted an overall effect the weighted average effect can be derived by setting the value of <code>cohort_2015</code> to 0.67.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions at end of follow-up</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># averaging over the entire sample</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>m_all_int_aap <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_all_int, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>, <span class="at">cohort_2015 =</span> (<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Untreated"</span>, <span class="st">"Treated"</span>))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># average treatment effect</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>m_all_int_ate <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(m_all_int, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>, <span class="at">cohort_2015 =</span> (<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>m_all_int_ates <span class="ot">&lt;-</span> m_all_int_aap <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_int_ate)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Population average effect: interaction model"</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=</span> m_all_int_ates),</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">notes =</span> <span class="st">"Note: cohort fixed effect set to 2/3."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_knc2oh8ybwatmp6iu8q8(i, j, css_id) {
        var table = document.getElementById("tinytable_knc2oh8ybwatmp6iu8q8");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_knc2oh8ybwatmp6iu8q8');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_knc2oh8ybwatmp6iu8q8(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_knc2oh8ybwatmp6iu8q8");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(0, 0, 'tinytable_css_idpkv2422lff9q5ysk71zy') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(0, 1, 'tinytable_css_idk12ffu88oapo461ie0e3') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(0, 2, 'tinytable_css_idt5303vwcpp8g9dvcetdk') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(0, 3, 'tinytable_css_idt5303vwcpp8g9dvcetdk') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(1, 0, 'tinytable_css_idt92rrekcb5fiqog15t87') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(1, 1, 'tinytable_css_idwbm9wy3in5gyt286wtmz') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(1, 2, 'tinytable_css_idwbm9wy3in5gyt286wtmz') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(1, 3, 'tinytable_css_idwbm9wy3in5gyt286wtmz') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(2, 0, 'tinytable_css_idm4xvqn1w3qu0005hz4j9') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(2, 1, 'tinytable_css_idt5303vwcpp8g9dvcetdk') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(2, 2, 'tinytable_css_idt5303vwcpp8g9dvcetdk') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(2, 3, 'tinytable_css_idt5303vwcpp8g9dvcetdk') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(3, 0, 'tinytable_css_idm4xvqn1w3qu0005hz4j9') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(3, 1, 'tinytable_css_idt5303vwcpp8g9dvcetdk') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(3, 2, 'tinytable_css_idt5303vwcpp8g9dvcetdk') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(3, 3, 'tinytable_css_idt5303vwcpp8g9dvcetdk') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(4, 0, 'tinytable_css_idm4xvqn1w3qu0005hz4j9') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(4, 1, 'tinytable_css_idt5303vwcpp8g9dvcetdk') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(4, 2, 'tinytable_css_idt5303vwcpp8g9dvcetdk') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(4, 3, 'tinytable_css_idt5303vwcpp8g9dvcetdk') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(5, 0, 'tinytable_css_idm4xvqn1w3qu0005hz4j9') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(5, 1, 'tinytable_css_idm4xvqn1w3qu0005hz4j9') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(5, 2, 'tinytable_css_idm4xvqn1w3qu0005hz4j9') })
window.addEventListener('load', function () { styleCell_knc2oh8ybwatmp6iu8q8(5, 3, 'tinytable_css_idm4xvqn1w3qu0005hz4j9') })
    </script>

    <style>
    .table td.tinytable_css_idpkv2422lff9q5ysk71zy, .table th.tinytable_css_idpkv2422lff9q5ysk71zy {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idk12ffu88oapo461ie0e3, .table th.tinytable_css_idk12ffu88oapo461ie0e3 {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idt5303vwcpp8g9dvcetdk, .table th.tinytable_css_idt5303vwcpp8g9dvcetdk {  text-align: center; }
    .table td.tinytable_css_idt92rrekcb5fiqog15t87, .table th.tinytable_css_idt92rrekcb5fiqog15t87 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idwbm9wy3in5gyt286wtmz, .table th.tinytable_css_idwbm9wy3in5gyt286wtmz {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idm4xvqn1w3qu0005hz4j9, .table th.tinytable_css_idm4xvqn1w3qu0005hz4j9 {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_knc2oh8ybwatmp6iu8q8" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Population average effect: interaction model</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="4">Note: cohort fixed effect set to 2/3.</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>Untreated </td>
                  <td>39.04</td>
                  <td>38.67</td>
                  <td>39.40</td>
                </tr>
                <tr>
                  <td>Treated   </td>
                  <td>50.11</td>
                  <td>49.79</td>
                  <td>50.44</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>11.08</td>
                  <td>10.92</td>
                  <td>11.23</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Same average predictions and treatment effects as we calculated above. We can do the same for the slopes:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cohort-specific treatment effects</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>m_all_int_aas <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_int, <span class="at">variable =</span> <span class="st">"year0"</span>, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>), </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="fu">c</span>(<span class="st">"b2 - b1 = 0"</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">"b4 - b3 = 0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"2010 cohort"</span>, <span class="st">"2015 cohort"</span>))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># weighted average of treatment slopes</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>m_all_int_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_int, </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="st">"year0"</span>, </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>), </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"(1/3)*(b2 - b1) + (2/3)*(b4 - b3) = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>m_all_int_aslope <span class="ot">&lt;-</span> m_all_int_aas <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_int_slope)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Population average slope: interaction model"</span> </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>                  <span class="ot">=</span> m_all_int_aslope), <span class="at">fmt =</span> <span class="dv">2</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> statistic,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">notes =</span> <span class="st">"Note: 2015 cohort weighted by 2/3."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_z160hx9w03zyepfcsfa0(i, j, css_id) {
        var table = document.getElementById("tinytable_z160hx9w03zyepfcsfa0");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_z160hx9w03zyepfcsfa0');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_z160hx9w03zyepfcsfa0(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_z160hx9w03zyepfcsfa0");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(0, 0, 'tinytable_css_ida7cy9p9ubrjqfhc7xc3s') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(0, 1, 'tinytable_css_idcda1hzt8wt7vkcsghjq0') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(0, 2, 'tinytable_css_idui2ys0zel0gydabde8c5') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(0, 3, 'tinytable_css_idui2ys0zel0gydabde8c5') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(1, 0, 'tinytable_css_ido71botk2t708w6r3k6af') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(1, 1, 'tinytable_css_id214spsc23murum4ydahb') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(1, 2, 'tinytable_css_id214spsc23murum4ydahb') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(1, 3, 'tinytable_css_id214spsc23murum4ydahb') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(2, 0, 'tinytable_css_id6twvf2seixg50ifx5mcf') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(2, 1, 'tinytable_css_idui2ys0zel0gydabde8c5') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(2, 2, 'tinytable_css_idui2ys0zel0gydabde8c5') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(2, 3, 'tinytable_css_idui2ys0zel0gydabde8c5') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(3, 0, 'tinytable_css_id6twvf2seixg50ifx5mcf') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(3, 1, 'tinytable_css_idui2ys0zel0gydabde8c5') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(3, 2, 'tinytable_css_idui2ys0zel0gydabde8c5') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(3, 3, 'tinytable_css_idui2ys0zel0gydabde8c5') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(4, 0, 'tinytable_css_id6twvf2seixg50ifx5mcf') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(4, 1, 'tinytable_css_idui2ys0zel0gydabde8c5') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(4, 2, 'tinytable_css_idui2ys0zel0gydabde8c5') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(4, 3, 'tinytable_css_idui2ys0zel0gydabde8c5') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(5, 0, 'tinytable_css_id6twvf2seixg50ifx5mcf') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(5, 1, 'tinytable_css_id6twvf2seixg50ifx5mcf') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(5, 2, 'tinytable_css_id6twvf2seixg50ifx5mcf') })
window.addEventListener('load', function () { styleCell_z160hx9w03zyepfcsfa0(5, 3, 'tinytable_css_id6twvf2seixg50ifx5mcf') })
    </script>

    <style>
    .table td.tinytable_css_ida7cy9p9ubrjqfhc7xc3s, .table th.tinytable_css_ida7cy9p9ubrjqfhc7xc3s {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idcda1hzt8wt7vkcsghjq0, .table th.tinytable_css_idcda1hzt8wt7vkcsghjq0 {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idui2ys0zel0gydabde8c5, .table th.tinytable_css_idui2ys0zel0gydabde8c5 {  text-align: center; }
    .table td.tinytable_css_ido71botk2t708w6r3k6af, .table th.tinytable_css_ido71botk2t708w6r3k6af {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id214spsc23murum4ydahb, .table th.tinytable_css_id214spsc23murum4ydahb {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id6twvf2seixg50ifx5mcf, .table th.tinytable_css_id6twvf2seixg50ifx5mcf {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_z160hx9w03zyepfcsfa0" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Population average slope: interaction model</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="4">Note: 2015 cohort weighted by 2/3.</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>2010 cohort</td>
                  <td>0.92</td>
                  <td>0.89</td>
                  <td>0.94</td>
                </tr>
                <tr>
                  <td>2015 cohort</td>
                  <td>1.95</td>
                  <td>1.91</td>
                  <td>1.99</td>
                </tr>
                <tr>
                  <td>Difference </td>
                  <td>1.61</td>
                  <td>1.58</td>
                  <td>1.63</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Now what about the treatment effects for the other models? If we ignore cohort all together:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions at end of follow-up</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>m_all_ap <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_all, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Untreated"</span>, <span class="st">"Treated"</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># effect of treatment</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>m_all_te <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(m_all, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># average slopes by treatment</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>m_all_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all, <span class="at">variables =</span> <span class="st">"year0"</span>, </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment slopes</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>m_all_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all, <span class="at">variables =</span> <span class="st">"year0"</span>, </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="st">"treat"</span>, <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>m_all_table <span class="ot">&lt;-</span> m_all_ap <span class="sc">%&gt;%</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_te, m_all_as, m_all_slope) <span class="sc">%&gt;%</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, estimate, std.error, conf.low, conf.high)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(m_all_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">" "</span>, <span class="st">"Est."</span>, <span class="st">"SE"</span>, <span class="st">"2.5%"</span>, <span class="st">"97.5%"</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="fu">tt</span>(m_all_table, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_tt</span>(<span class="at">j =</span> <span class="fu">list</span>(<span class="st">"No cohort FE"</span> <span class="ot">=</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">i =</span> <span class="fu">list</span>(<span class="st">"Predictions at end"</span> <span class="ot">=</span> <span class="dv">1</span>, </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Slope estimates"</span> <span class="ot">=</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_js8q7kvov5jss4tcj45z(i, j, css_id) {
        var table = document.getElementById("tinytable_js8q7kvov5jss4tcj45z");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow_qtaihe356abiilds7cuq(i, colspan, content) {
        var table = document.getElementById('tinytable_js8q7kvov5jss4tcj45z');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_js8q7kvov5jss4tcj45z(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_js8q7kvov5jss4tcj45z");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { insertSpanRow_qtaihe356abiilds7cuq(5, 5, 'Slope estimates') });
window.addEventListener('load', function () { insertSpanRow_qtaihe356abiilds7cuq(2, 5, 'Predictions at end') });
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(0, 0, 'tinytable_css_idn3ekm4dix1akh6yl7fid') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(0, 1, 'tinytable_css_idwvv8urwmco0s5ywdvvam') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(0, 2, 'tinytable_css_idn3ekm4dix1akh6yl7fid') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(0, 3, 'tinytable_css_idn3ekm4dix1akh6yl7fid') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(0, 4, 'tinytable_css_idn3ekm4dix1akh6yl7fid') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(1, 0, 'tinytable_css_id8otk1febh74u1j0r75us') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(1, 1, 'tinytable_css_id8otk1febh74u1j0r75us') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(1, 2, 'tinytable_css_id8otk1febh74u1j0r75us') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(1, 3, 'tinytable_css_id8otk1febh74u1j0r75us') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(1, 4, 'tinytable_css_id8otk1febh74u1j0r75us') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(3, 0, 'tinytable_css_id2m9h6g3w98dkhgebkqyu') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(4, 0, 'tinytable_css_id2m9h6g3w98dkhgebkqyu') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(5, 0, 'tinytable_css_id2m9h6g3w98dkhgebkqyu') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(7, 0, 'tinytable_css_id2m9h6g3w98dkhgebkqyu') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(8, 0, 'tinytable_css_id2m9h6g3w98dkhgebkqyu') })
window.addEventListener('load', function () { styleCell_js8q7kvov5jss4tcj45z(9, 0, 'tinytable_css_id2m9h6g3w98dkhgebkqyu') })
    </script>

    <style>
    .table td.tinytable_css_idn3ekm4dix1akh6yl7fid, .table th.tinytable_css_idn3ekm4dix1akh6yl7fid {  text-align: center; }
    .table td.tinytable_css_idwvv8urwmco0s5ywdvvam, .table th.tinytable_css_idwvv8urwmco0s5ywdvvam {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_id8otk1febh74u1j0r75us, .table th.tinytable_css_id8otk1febh74u1j0r75us {  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id2m9h6g3w98dkhgebkqyu, .table th.tinytable_css_id2m9h6g3w98dkhgebkqyu { padding-left: 1em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_js8q7kvov5jss4tcj45z" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="4">No cohort FE</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">SE</th>
                <th scope="col">2.5%</th>
                <th scope="col">97.5%</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Untreated </td>
                  <td>33.37</td>
                  <td>0.409</td>
                  <td>32.57</td>
                  <td>34.17</td>
                </tr>
                <tr>
                  <td>Treated   </td>
                  <td>47.08</td>
                  <td>1.87 </td>
                  <td>43.42</td>
                  <td>50.75</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>13.71</td>
                  <td>1.554</td>
                  <td>10.66</td>
                  <td>16.76</td>
                </tr>
                <tr>
                  <td>Pre       </td>
                  <td> 1.05</td>
                  <td>0.011</td>
                  <td> 1.03</td>
                  <td> 1.07</td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td> 1.47</td>
                  <td>0.104</td>
                  <td> 1.26</td>
                  <td> 1.67</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td> 0.41</td>
                  <td>0.102</td>
                  <td> 0.21</td>
                  <td> 0.62</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Not good. If the true impacts are an average effect of 11.08 by the end of follow-up and an average slope of 1.61, these estimates are not correct. What happens if we just condition on cohort without allowing for separate treatment effects?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions at end of follow-up</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>m_all_s_ap <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_all_s, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cohort_2015 =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Untreated"</span>,<span class="st">"Treated"</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># effect of treatment at end of follow-up</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>m_all_s_te <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(m_all_s, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cohort_2015 =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># average slope</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>m_all_s_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_s, </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"year0"</span>, <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment effect</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>m_all_s_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_s, <span class="at">variables =</span> <span class="st">"year0"</span>, </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="st">"treat"</span>, <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>m_all_s_table <span class="ot">&lt;-</span> m_all_s_ap <span class="sc">%&gt;%</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_s_te, m_all_s_as, m_all_s_slope) <span class="sc">%&gt;%</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, estimate, std.error, conf.low, conf.high)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(m_all_s_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">" "</span>, <span class="st">"Est."</span>, <span class="st">"SE"</span>, <span class="st">"2.5%"</span>, <span class="st">"97.5%"</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="fu">tt</span>(m_all_s_table, <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>   <span class="at">notes =</span> <span class="st">"Note: Cohort set to 2/3 for predictions"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_tt</span>(<span class="at">j =</span> <span class="fu">list</span>(<span class="st">"With cohort FE"</span> <span class="ot">=</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">i =</span> <span class="fu">list</span>(<span class="st">"Predictions at end"</span> <span class="ot">=</span> <span class="dv">1</span>, </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Slope estimates"</span> <span class="ot">=</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_6e4k7bzxkzhxhljcy6ra(i, j, css_id) {
        var table = document.getElementById("tinytable_6e4k7bzxkzhxhljcy6ra");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow_rlmgxerz3r7pt2gt0mqt(i, colspan, content) {
        var table = document.getElementById('tinytable_6e4k7bzxkzhxhljcy6ra');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_6e4k7bzxkzhxhljcy6ra(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_6e4k7bzxkzhxhljcy6ra");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { insertSpanRow_rlmgxerz3r7pt2gt0mqt(5, 5, 'Slope estimates') });
window.addEventListener('load', function () { insertSpanRow_rlmgxerz3r7pt2gt0mqt(2, 5, 'Predictions at end') });
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(0, 0, 'tinytable_css_id70dxuxos4k5y7na8iiyg') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(0, 1, 'tinytable_css_idy9vptjf2d1fl22z01xpj') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(0, 2, 'tinytable_css_id70dxuxos4k5y7na8iiyg') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(0, 3, 'tinytable_css_id70dxuxos4k5y7na8iiyg') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(0, 4, 'tinytable_css_id70dxuxos4k5y7na8iiyg') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(1, 0, 'tinytable_css_ide43p414mq4psuoiz8i3i') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(1, 1, 'tinytable_css_ide43p414mq4psuoiz8i3i') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(1, 2, 'tinytable_css_ide43p414mq4psuoiz8i3i') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(1, 3, 'tinytable_css_ide43p414mq4psuoiz8i3i') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(1, 4, 'tinytable_css_ide43p414mq4psuoiz8i3i') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(3, 0, 'tinytable_css_idtmm42szlg6ae10o34pq5') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(4, 0, 'tinytable_css_idtmm42szlg6ae10o34pq5') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(5, 0, 'tinytable_css_idtmm42szlg6ae10o34pq5') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(7, 0, 'tinytable_css_idtmm42szlg6ae10o34pq5') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(8, 0, 'tinytable_css_idtmm42szlg6ae10o34pq5') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(9, 0, 'tinytable_css_idtmm42szlg6ae10o34pq5') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(10, 0, 'tinytable_css_idvrbz14l52nxizyjkh47k') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(10, 1, 'tinytable_css_idvrbz14l52nxizyjkh47k') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(10, 2, 'tinytable_css_idvrbz14l52nxizyjkh47k') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(10, 3, 'tinytable_css_idvrbz14l52nxizyjkh47k') })
window.addEventListener('load', function () { styleCell_6e4k7bzxkzhxhljcy6ra(10, 4, 'tinytable_css_idvrbz14l52nxizyjkh47k') })
    </script>

    <style>
    .table td.tinytable_css_id70dxuxos4k5y7na8iiyg, .table th.tinytable_css_id70dxuxos4k5y7na8iiyg {  text-align: center; }
    .table td.tinytable_css_idy9vptjf2d1fl22z01xpj, .table th.tinytable_css_idy9vptjf2d1fl22z01xpj {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_ide43p414mq4psuoiz8i3i, .table th.tinytable_css_ide43p414mq4psuoiz8i3i {  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idtmm42szlg6ae10o34pq5, .table th.tinytable_css_idtmm42szlg6ae10o34pq5 { padding-left: 1em; }
    .table td.tinytable_css_idvrbz14l52nxizyjkh47k, .table th.tinytable_css_idvrbz14l52nxizyjkh47k {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_6e4k7bzxkzhxhljcy6ra" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="4">With cohort FE</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">SE</th>
                <th scope="col">2.5%</th>
                <th scope="col">97.5%</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="5">Note: Cohort set to 2/3 for predictions</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>Untreated </td>
                  <td>38.65</td>
                  <td>0.562</td>
                  <td>37.55</td>
                  <td>39.7</td>
                </tr>
                <tr>
                  <td>Treated   </td>
                  <td>48.77</td>
                  <td>0.764</td>
                  <td>47.28</td>
                  <td>50.3</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>10.13</td>
                  <td>0.222</td>
                  <td> 9.69</td>
                  <td>10.6</td>
                </tr>
                <tr>
                  <td>Pre       </td>
                  <td> 1.38</td>
                  <td>0.073</td>
                  <td> 1.23</td>
                  <td> 1.5</td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td> 2.33</td>
                  <td>0.028</td>
                  <td> 2.27</td>
                  <td> 2.4</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td> 0.95</td>
                  <td>0.047</td>
                  <td> 0.86</td>
                  <td> 1  </td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>This is a little better but generally still not correct, which is perhaps not that surprising since simply adding a cohort fixed effect only allows for a level shift.</p>
</section>
<section id="relative-time" class="level2">
<h2 class="anchored" data-anchor-id="relative-time">Relative time</h2>
<p>Now letâ€™s work with relative time. First, letâ€™s plot the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ds <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> yearc, <span class="at">y =</span> y, <span class="at">group =</span> unit)) <span class="sc">+</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> ds <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cohort_year, yearc) <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">mean</span>(y)),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">aes</span>(<span class="at">x =</span> yearc, <span class="at">y =</span> y, <span class="at">group =</span> <span class="fu">factor</span>(cohort_year),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">factor</span>(cohort_year)), <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> ds <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(yearc) <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">mean</span>(y)),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> yearc, <span class="at">y =</span> y, <span class="at">color =</span> <span class="st">"#4daf4a"</span>, <span class="at">group=</span><span class="st">"All"</span>), </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Y"</span>,  <span class="at">color =</span> <span class="st">"Treatment group   "</span>) <span class="sc">+</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'#984ea3'</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">'Set1'</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"2010"</span>, <span class="st">"2015"</span>, <span class="st">"Average"</span>)) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="its-sim_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Yeah, this looks a little strange, and you can see that of course the average slope in the early period is only coming from the 2015 cohort, and the slope in the later post period is only coming from the 2010 cohort.</p>
<p>Letâ€™s start with the model that has no cohort fixed effects.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>m_all_c <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> yearc <span class="sc">*</span> treat, <span class="at">data=</span>ds, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>m_all_c_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_c, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>m_all_c_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_c, </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>m_all_c_slopes <span class="ot">&lt;-</span> m_all_c_as <span class="sc">%&gt;%</span> </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_c_slope)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Average slopes: No cohort"</span> <span class="ot">=</span> m_all_c_slopes),</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_grmcnv3w1genblg8csmh(i, j, css_id) {
        var table = document.getElementById("tinytable_grmcnv3w1genblg8csmh");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_grmcnv3w1genblg8csmh');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_grmcnv3w1genblg8csmh(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_grmcnv3w1genblg8csmh");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(0, 0, 'tinytable_css_idc168wt143frkhjmfpi16') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(0, 1, 'tinytable_css_idlzjsb6m9bu5ajfsuhibk') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(0, 2, 'tinytable_css_idil2z0by8bv7qjtw6fism') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(0, 3, 'tinytable_css_idil2z0by8bv7qjtw6fism') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(1, 0, 'tinytable_css_id99jmh5k8jhroodl1psu2') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(1, 1, 'tinytable_css_id4fy3x4qie5dfccio95la') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(1, 2, 'tinytable_css_id4fy3x4qie5dfccio95la') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(1, 3, 'tinytable_css_id4fy3x4qie5dfccio95la') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(2, 0, 'tinytable_css_id46wtejunnnon93vyeo2v') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(2, 1, 'tinytable_css_idil2z0by8bv7qjtw6fism') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(2, 2, 'tinytable_css_idil2z0by8bv7qjtw6fism') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(2, 3, 'tinytable_css_idil2z0by8bv7qjtw6fism') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(3, 0, 'tinytable_css_id46wtejunnnon93vyeo2v') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(3, 1, 'tinytable_css_idil2z0by8bv7qjtw6fism') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(3, 2, 'tinytable_css_idil2z0by8bv7qjtw6fism') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(3, 3, 'tinytable_css_idil2z0by8bv7qjtw6fism') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(4, 0, 'tinytable_css_id46wtejunnnon93vyeo2v') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(4, 1, 'tinytable_css_idil2z0by8bv7qjtw6fism') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(4, 2, 'tinytable_css_idil2z0by8bv7qjtw6fism') })
window.addEventListener('load', function () { styleCell_grmcnv3w1genblg8csmh(4, 3, 'tinytable_css_idil2z0by8bv7qjtw6fism') })
    </script>

    <style>
    .table td.tinytable_css_idc168wt143frkhjmfpi16, .table th.tinytable_css_idc168wt143frkhjmfpi16 {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idlzjsb6m9bu5ajfsuhibk, .table th.tinytable_css_idlzjsb6m9bu5ajfsuhibk {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idil2z0by8bv7qjtw6fism, .table th.tinytable_css_idil2z0by8bv7qjtw6fism {  text-align: center; }
    .table td.tinytable_css_id99jmh5k8jhroodl1psu2, .table th.tinytable_css_id99jmh5k8jhroodl1psu2 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id4fy3x4qie5dfccio95la, .table th.tinytable_css_id4fy3x4qie5dfccio95la {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id46wtejunnnon93vyeo2v, .table th.tinytable_css_id46wtejunnnon93vyeo2v {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_grmcnv3w1genblg8csmh" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Average slopes: No cohort</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Pre       </td>
                  <td>1.17</td>
                  <td>1.11</td>
                  <td>1.22</td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td>3.28</td>
                  <td>3.20</td>
                  <td>3.37</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>2.12</td>
                  <td>2.00</td>
                  <td>2.23</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>This gives us biased estimates slope effects (recall that the average slope should be 1.61) Moreover, since we are now working with relative time we canâ€™t specify the treatment effect at the end of follow-up, we have to specify a relative time. But this means either extrapolating beyond the observed data for the later-treated cohort (if we set <code>yearc</code> to 10 years post), or shortening the time horizon for the early treated cohort (if we set <code>yearc</code> to 5). Here are the estimated predictions and treatment effects at year 10 post intervention:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions at 10 years of follow up</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>m_all_c_ap <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_all_c, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">yearc =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Untreated"</span>,<span class="st">"Treated"</span>))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># effect of treatment</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>m_all_c_te <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(m_all_c, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">yearc =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>m_all_c_ate <span class="ot">&lt;-</span> m_all_c_ap <span class="sc">%&gt;%</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_c_te)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"No cohort fixed effect"</span> </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=</span> m_all_c_ate),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">notes =</span> <span class="st">"Note: predictions 10-years post intervention"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_p5z4og6pt8b9ruao4lqb(i, j, css_id) {
        var table = document.getElementById("tinytable_p5z4og6pt8b9ruao4lqb");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_p5z4og6pt8b9ruao4lqb');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_p5z4og6pt8b9ruao4lqb(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_p5z4og6pt8b9ruao4lqb");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(0, 0, 'tinytable_css_idt1k1j3sklgtbfddahigz') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(0, 1, 'tinytable_css_idrg7ull2dr3j31yqmtaue') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(0, 2, 'tinytable_css_idw3fgtzfg67e5wi6t0jup') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(0, 3, 'tinytable_css_idw3fgtzfg67e5wi6t0jup') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(1, 0, 'tinytable_css_id39blb1gm44y31dc9voww') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(1, 1, 'tinytable_css_idedhdrunoyhnr0q0xcqr7') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(1, 2, 'tinytable_css_idedhdrunoyhnr0q0xcqr7') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(1, 3, 'tinytable_css_idedhdrunoyhnr0q0xcqr7') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(2, 0, 'tinytable_css_idx3ivydxwtzdy22ndekls') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(2, 1, 'tinytable_css_idw3fgtzfg67e5wi6t0jup') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(2, 2, 'tinytable_css_idw3fgtzfg67e5wi6t0jup') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(2, 3, 'tinytable_css_idw3fgtzfg67e5wi6t0jup') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(3, 0, 'tinytable_css_idx3ivydxwtzdy22ndekls') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(3, 1, 'tinytable_css_idw3fgtzfg67e5wi6t0jup') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(3, 2, 'tinytable_css_idw3fgtzfg67e5wi6t0jup') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(3, 3, 'tinytable_css_idw3fgtzfg67e5wi6t0jup') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(4, 0, 'tinytable_css_idx3ivydxwtzdy22ndekls') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(4, 1, 'tinytable_css_idw3fgtzfg67e5wi6t0jup') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(4, 2, 'tinytable_css_idw3fgtzfg67e5wi6t0jup') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(4, 3, 'tinytable_css_idw3fgtzfg67e5wi6t0jup') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(5, 0, 'tinytable_css_idx3ivydxwtzdy22ndekls') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(5, 1, 'tinytable_css_idx3ivydxwtzdy22ndekls') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(5, 2, 'tinytable_css_idx3ivydxwtzdy22ndekls') })
window.addEventListener('load', function () { styleCell_p5z4og6pt8b9ruao4lqb(5, 3, 'tinytable_css_idx3ivydxwtzdy22ndekls') })
    </script>

    <style>
    .table td.tinytable_css_idt1k1j3sklgtbfddahigz, .table th.tinytable_css_idt1k1j3sklgtbfddahigz {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idrg7ull2dr3j31yqmtaue, .table th.tinytable_css_idrg7ull2dr3j31yqmtaue {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idw3fgtzfg67e5wi6t0jup, .table th.tinytable_css_idw3fgtzfg67e5wi6t0jup {  text-align: center; }
    .table td.tinytable_css_id39blb1gm44y31dc9voww, .table th.tinytable_css_id39blb1gm44y31dc9voww {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idedhdrunoyhnr0q0xcqr7, .table th.tinytable_css_idedhdrunoyhnr0q0xcqr7 {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idx3ivydxwtzdy22ndekls, .table th.tinytable_css_idx3ivydxwtzdy22ndekls {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_p5z4og6pt8b9ruao4lqb" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">No cohort fixed effect</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="4">Note: predictions 10-years post intervention</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>Untreated </td>
                  <td>39.34</td>
                  <td>38.51</td>
                  <td>40.16</td>
                </tr>
                <tr>
                  <td>Treated   </td>
                  <td>62.47</td>
                  <td>61.90</td>
                  <td>63.04</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>23.13</td>
                  <td>22.58</td>
                  <td>23.68</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Now we get an estimate of 23.13. Recall that the overall average effect at the end of follow-up was 1.61. Obviously extrapolation is having some consequence here.</p>
<p>Letâ€™s add a cohort fixed effect and look at the estimated slope effect:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>m_all_cs <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> cohort_2015 <span class="sc">+</span> yearc <span class="sc">*</span> treat, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>ds, <span class="at">clusters =</span> state)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>m_all_cs_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_cs, </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>m_all_cs_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_cs, </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>m_all_cs_slopes <span class="ot">&lt;-</span> m_all_cs_as <span class="sc">%&gt;%</span> </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_cs_slope)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Average slopes: Cohort FE"</span> </span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>                   <span class="ot">=</span> m_all_cs_slopes),</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_9zn5zr3qy5lykw77cima(i, j, css_id) {
        var table = document.getElementById("tinytable_9zn5zr3qy5lykw77cima");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_9zn5zr3qy5lykw77cima');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_9zn5zr3qy5lykw77cima(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_9zn5zr3qy5lykw77cima");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(0, 0, 'tinytable_css_idy2j8bpfmv8822i5n8c9z') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(0, 1, 'tinytable_css_id5sij2f3m1l6gwp2d9b1v') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(0, 2, 'tinytable_css_idkk67vpknacv0pv26jvw0') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(0, 3, 'tinytable_css_idkk67vpknacv0pv26jvw0') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(1, 0, 'tinytable_css_idub0x85g29mtua4h6ct4u') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(1, 1, 'tinytable_css_idpocqfktrbujdgnq0vbof') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(1, 2, 'tinytable_css_idpocqfktrbujdgnq0vbof') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(1, 3, 'tinytable_css_idpocqfktrbujdgnq0vbof') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(2, 0, 'tinytable_css_idroozku3jjrzu1wvyqvre') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(2, 1, 'tinytable_css_idkk67vpknacv0pv26jvw0') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(2, 2, 'tinytable_css_idkk67vpknacv0pv26jvw0') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(2, 3, 'tinytable_css_idkk67vpknacv0pv26jvw0') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(3, 0, 'tinytable_css_idroozku3jjrzu1wvyqvre') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(3, 1, 'tinytable_css_idkk67vpknacv0pv26jvw0') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(3, 2, 'tinytable_css_idkk67vpknacv0pv26jvw0') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(3, 3, 'tinytable_css_idkk67vpknacv0pv26jvw0') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(4, 0, 'tinytable_css_idroozku3jjrzu1wvyqvre') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(4, 1, 'tinytable_css_idkk67vpknacv0pv26jvw0') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(4, 2, 'tinytable_css_idkk67vpknacv0pv26jvw0') })
window.addEventListener('load', function () { styleCell_9zn5zr3qy5lykw77cima(4, 3, 'tinytable_css_idkk67vpknacv0pv26jvw0') })
    </script>

    <style>
    .table td.tinytable_css_idy2j8bpfmv8822i5n8c9z, .table th.tinytable_css_idy2j8bpfmv8822i5n8c9z {  text-align: center;  text-align: left; }
    .table td.tinytable_css_id5sij2f3m1l6gwp2d9b1v, .table th.tinytable_css_id5sij2f3m1l6gwp2d9b1v {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idkk67vpknacv0pv26jvw0, .table th.tinytable_css_idkk67vpknacv0pv26jvw0 {  text-align: center; }
    .table td.tinytable_css_idub0x85g29mtua4h6ct4u, .table th.tinytable_css_idub0x85g29mtua4h6ct4u {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idpocqfktrbujdgnq0vbof, .table th.tinytable_css_idpocqfktrbujdgnq0vbof {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idroozku3jjrzu1wvyqvre, .table th.tinytable_css_idroozku3jjrzu1wvyqvre {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_9zn5zr3qy5lykw77cima" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Average slopes: Cohort FE</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Pre       </td>
                  <td>1.14</td>
                  <td>1.09</td>
                  <td>1.18</td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td>3.20</td>
                  <td>3.17</td>
                  <td>3.23</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>2.06</td>
                  <td>1.99</td>
                  <td>2.14</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Our estimate is now 2.06, compared to the true estimate of 1.61.</p>
<p>Now letâ€™s limit our comparisons to only the years where we have sufficient overlap of years once we center things (i.e., where <code>yearc</code> &gt;= -9 or &lt;= 5). Here is a plot of the restricted data:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="its-sim_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here are the models using relative time, with and without a cohort fixed effect:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>m_all_cr <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> yearc <span class="sc">*</span> treat, </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span><span class="fu">subset</span>(ds, yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>), </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>m_all_crs <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> cohort_2015 <span class="sc">+</span> yearc <span class="sc">*</span> treat, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span><span class="fu">subset</span>(ds, yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>), </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"No cohort"</span> <span class="ot">=</span> m_all_cr,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cohort FE"</span> <span class="ot">=</span> m_all_crs),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_asvlgq28o1uff94o5y7o(i, j, css_id) {
        var table = document.getElementById("tinytable_asvlgq28o1uff94o5y7o");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_asvlgq28o1uff94o5y7o');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_asvlgq28o1uff94o5y7o(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_asvlgq28o1uff94o5y7o");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(0, 0, 'tinytable_css_id0s83rvkuh7r7lk0hxl94') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(0, 1, 'tinytable_css_idacww5t4dt73gfzpmbehf') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(0, 2, 'tinytable_css_idacww5t4dt73gfzpmbehf') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(1, 0, 'tinytable_css_idd567c0cpp5is01gpwx1h') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(1, 1, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(1, 2, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(2, 0, 'tinytable_css_idd567c0cpp5is01gpwx1h') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(2, 1, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(2, 2, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(3, 0, 'tinytable_css_idd567c0cpp5is01gpwx1h') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(3, 1, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(3, 2, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(4, 0, 'tinytable_css_idd567c0cpp5is01gpwx1h') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(4, 1, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(4, 2, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(5, 0, 'tinytable_css_idd567c0cpp5is01gpwx1h') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(5, 1, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(5, 2, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(6, 0, 'tinytable_css_idd567c0cpp5is01gpwx1h') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(6, 1, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(6, 2, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(7, 0, 'tinytable_css_idd567c0cpp5is01gpwx1h') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(7, 1, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(7, 2, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(8, 0, 'tinytable_css_idd567c0cpp5is01gpwx1h') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(8, 1, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(8, 2, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(9, 0, 'tinytable_css_idd567c0cpp5is01gpwx1h') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(9, 1, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(9, 2, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(10, 0, 'tinytable_css_id2lah903n892wd6us5lbo') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(10, 1, 'tinytable_css_id2stgzfk8nbnl1fc3tx1u') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(10, 2, 'tinytable_css_id2stgzfk8nbnl1fc3tx1u') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(11, 0, 'tinytable_css_idd567c0cpp5is01gpwx1h') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(11, 1, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(11, 2, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(12, 0, 'tinytable_css_idd567c0cpp5is01gpwx1h') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(12, 1, 'tinytable_css_idmwglxh40edvec3puf54l') })
window.addEventListener('load', function () { styleCell_asvlgq28o1uff94o5y7o(12, 2, 'tinytable_css_idmwglxh40edvec3puf54l') })
    </script>

    <style>
    .table td.tinytable_css_id0s83rvkuh7r7lk0hxl94, .table th.tinytable_css_id0s83rvkuh7r7lk0hxl94 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idacww5t4dt73gfzpmbehf, .table th.tinytable_css_idacww5t4dt73gfzpmbehf {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idd567c0cpp5is01gpwx1h, .table th.tinytable_css_idd567c0cpp5is01gpwx1h {  text-align: left; }
    .table td.tinytable_css_idmwglxh40edvec3puf54l, .table th.tinytable_css_idmwglxh40edvec3puf54l {  text-align: center; }
    .table td.tinytable_css_id2lah903n892wd6us5lbo, .table th.tinytable_css_id2lah903n892wd6us5lbo {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_id2stgzfk8nbnl1fc3tx1u, .table th.tinytable_css_id2stgzfk8nbnl1fc3tx1u {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_asvlgq28o1uff94o5y7o" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">No cohort</th>
                <th scope="col">Cohort FE</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)  </td>
                  <td>28.65    </td>
                  <td>29.45    </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.36)   </td>
                  <td>(0.34)   </td>
                </tr>
                <tr>
                  <td>yearc        </td>
                  <td>1.41     </td>
                  <td>1.41     </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.08)   </td>
                  <td>(0.08)   </td>
                </tr>
                <tr>
                  <td>treat        </td>
                  <td>1.48     </td>
                  <td>1.48     </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.08)   </td>
                  <td>(0.08)   </td>
                </tr>
                <tr>
                  <td>yearc Ã— treat</td>
                  <td>1.62     </td>
                  <td>1.62     </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.09)   </td>
                  <td>(0.09)   </td>
                </tr>
                <tr>
                  <td>cohort_2015  </td>
                  <td>         </td>
                  <td>-1.18    </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>         </td>
                  <td>(0.35)   </td>
                </tr>
                <tr>
                  <td>Num.Obs.     </td>
                  <td>15000    </td>
                  <td>15000    </td>
                </tr>
                <tr>
                  <td>Std.Errors   </td>
                  <td>by: state</td>
                  <td>by: state</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>As the model comparison shows, including just the cohort fixed effect here only allows for a â€˜level shiftâ€™, so it has no impact on the slope for <code>yearc</code> or the product term between <code>treat</code> and <code>yearc</code>. So these models will both produce the same average slopes (though not the same average predictions because of the cohort fixed effect).</p>
<p>What about our slope estimates now?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>m_all_crs_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_crs, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>m_all_crs_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_crs, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>m_all_crs_slopes <span class="ot">&lt;-</span> m_all_crs_as <span class="sc">%&gt;%</span> </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_crs_slope)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Average slopes: Cohort FE"</span> </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                   <span class="ot">=</span> m_all_crs_slopes),</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_0819akb2uk3dap3a4o7a(i, j, css_id) {
        var table = document.getElementById("tinytable_0819akb2uk3dap3a4o7a");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_0819akb2uk3dap3a4o7a');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_0819akb2uk3dap3a4o7a(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_0819akb2uk3dap3a4o7a");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(0, 0, 'tinytable_css_idi2r8pcigrrjbkj1wnuwv') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(0, 1, 'tinytable_css_id1c33i2i7gjhagvgur7vp') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(0, 2, 'tinytable_css_idk04gfjwa72s6qo2eylw3') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(0, 3, 'tinytable_css_idk04gfjwa72s6qo2eylw3') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(1, 0, 'tinytable_css_idyi15av1f1mm2du9b0ajg') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(1, 1, 'tinytable_css_id0d9fignwz7gns7oqyz74') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(1, 2, 'tinytable_css_id0d9fignwz7gns7oqyz74') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(1, 3, 'tinytable_css_id0d9fignwz7gns7oqyz74') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(2, 0, 'tinytable_css_idlj9p3gvmsp73lozfsps4') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(2, 1, 'tinytable_css_idk04gfjwa72s6qo2eylw3') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(2, 2, 'tinytable_css_idk04gfjwa72s6qo2eylw3') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(2, 3, 'tinytable_css_idk04gfjwa72s6qo2eylw3') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(3, 0, 'tinytable_css_idlj9p3gvmsp73lozfsps4') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(3, 1, 'tinytable_css_idk04gfjwa72s6qo2eylw3') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(3, 2, 'tinytable_css_idk04gfjwa72s6qo2eylw3') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(3, 3, 'tinytable_css_idk04gfjwa72s6qo2eylw3') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(4, 0, 'tinytable_css_idlj9p3gvmsp73lozfsps4') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(4, 1, 'tinytable_css_idk04gfjwa72s6qo2eylw3') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(4, 2, 'tinytable_css_idk04gfjwa72s6qo2eylw3') })
window.addEventListener('load', function () { styleCell_0819akb2uk3dap3a4o7a(4, 3, 'tinytable_css_idk04gfjwa72s6qo2eylw3') })
    </script>

    <style>
    .table td.tinytable_css_idi2r8pcigrrjbkj1wnuwv, .table th.tinytable_css_idi2r8pcigrrjbkj1wnuwv {  text-align: center;  text-align: left; }
    .table td.tinytable_css_id1c33i2i7gjhagvgur7vp, .table th.tinytable_css_id1c33i2i7gjhagvgur7vp {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idk04gfjwa72s6qo2eylw3, .table th.tinytable_css_idk04gfjwa72s6qo2eylw3 {  text-align: center; }
    .table td.tinytable_css_idyi15av1f1mm2du9b0ajg, .table th.tinytable_css_idyi15av1f1mm2du9b0ajg {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id0d9fignwz7gns7oqyz74, .table th.tinytable_css_id0d9fignwz7gns7oqyz74 {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idlj9p3gvmsp73lozfsps4, .table th.tinytable_css_idlj9p3gvmsp73lozfsps4 {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_0819akb2uk3dap3a4o7a" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Average slopes: Cohort FE</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Pre       </td>
                  <td>1.41</td>
                  <td>1.25</td>
                  <td>1.57</td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td>3.02</td>
                  <td>2.99</td>
                  <td>3.06</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>1.62</td>
                  <td>1.44</td>
                  <td>1.79</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>The average slope for the model with cohort is 1.62, which is nearly the same as we calculated as a weighted average for the full sample using calendar time, which was 1.61</p>
<p>How about for a fully-interacted model with relative time? Letâ€™s compare it with our model using all of the data above:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>m_all_scri <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> cohort_2015 <span class="sc">*</span> yearc <span class="sc">*</span> treat,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span><span class="fu">subset</span>(ds, yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>), </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Calendar time"</span> <span class="ot">=</span> m_all_int,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Relative time"</span> <span class="ot">=</span> m_all_scri), </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_rename =</span> <span class="fu">c</span>(<span class="st">"year0"</span> <span class="ot">=</span> <span class="st">"year"</span>, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"yearc"</span> <span class="ot">=</span> <span class="st">"year"</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_i82dp6c88nausrjjbu0w(i, j, css_id) {
        var table = document.getElementById("tinytable_i82dp6c88nausrjjbu0w");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_i82dp6c88nausrjjbu0w');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_i82dp6c88nausrjjbu0w(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_i82dp6c88nausrjjbu0w");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(0, 0, 'tinytable_css_id9uwj4gscf7av3ay4igni') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(0, 1, 'tinytable_css_idt1aihnblcsmm3ctr2bmh') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(0, 2, 'tinytable_css_idt1aihnblcsmm3ctr2bmh') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(1, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(1, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(1, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(2, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(2, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(2, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(3, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(3, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(3, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(4, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(4, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(4, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(5, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(5, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(5, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(6, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(6, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(6, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(7, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(7, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(7, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(8, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(8, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(8, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(9, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(9, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(9, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(10, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(10, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(10, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(11, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(11, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(11, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(12, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(12, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(12, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(13, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(13, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(13, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(14, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(14, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(14, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(15, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(15, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(15, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(16, 0, 'tinytable_css_idxaoezbe9kp5uzlhepchf') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(16, 1, 'tinytable_css_idtjlybk1khbrk9krxaasi') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(16, 2, 'tinytable_css_idtjlybk1khbrk9krxaasi') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(17, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(17, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(17, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(18, 0, 'tinytable_css_idr24t5kt4lomqm8u3ojpa') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(18, 1, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
window.addEventListener('load', function () { styleCell_i82dp6c88nausrjjbu0w(18, 2, 'tinytable_css_idizqyyh9jzp7k3yrbw6ji') })
    </script>

    <style>
    .table td.tinytable_css_id9uwj4gscf7av3ay4igni, .table th.tinytable_css_id9uwj4gscf7av3ay4igni {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idt1aihnblcsmm3ctr2bmh, .table th.tinytable_css_idt1aihnblcsmm3ctr2bmh {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idr24t5kt4lomqm8u3ojpa, .table th.tinytable_css_idr24t5kt4lomqm8u3ojpa {  text-align: left; }
    .table td.tinytable_css_idizqyyh9jzp7k3yrbw6ji, .table th.tinytable_css_idizqyyh9jzp7k3yrbw6ji {  text-align: center; }
    .table td.tinytable_css_idxaoezbe9kp5uzlhepchf, .table th.tinytable_css_idxaoezbe9kp5uzlhepchf {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idtjlybk1khbrk9krxaasi, .table th.tinytable_css_idtjlybk1khbrk9krxaasi {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_i82dp6c88nausrjjbu0w" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Calendar time</th>
                <th scope="col">Relative time</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)           </td>
                  <td>12.97    </td>
                  <td>31.21    </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.28)   </td>
                  <td>(0.27)   </td>
                </tr>
                <tr>
                  <td>cohort_2015           </td>
                  <td>-0.93    </td>
                  <td>-3.79    </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.36)   </td>
                  <td>(0.34)   </td>
                </tr>
                <tr>
                  <td>year                  </td>
                  <td>2.03     </td>
                  <td>2.03     </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.01)   </td>
                  <td>(0.01)   </td>
                </tr>
                <tr>
                  <td>treat                 </td>
                  <td>-6.44    </td>
                  <td>1.83     </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.12)   </td>
                  <td>(0.12)   </td>
                </tr>
                <tr>
                  <td>cohort_2015:year      </td>
                  <td>-0.93    </td>
                  <td>-0.92    </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.01)   </td>
                  <td>(0.01)   </td>
                </tr>
                <tr>
                  <td>cohort_2015:treat     </td>
                  <td>-19.48   </td>
                  <td>-0.51    </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.38)   </td>
                  <td>(0.15)   </td>
                </tr>
                <tr>
                  <td>year:treat            </td>
                  <td>0.92     </td>
                  <td>0.95     </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.01)   </td>
                  <td>(0.03)   </td>
                </tr>
                <tr>
                  <td>cohort_2015:year:treat</td>
                  <td>1.03     </td>
                  <td>0.98     </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.02)   </td>
                  <td>(0.03)   </td>
                </tr>
                <tr>
                  <td>Num.Obs.              </td>
                  <td>20000    </td>
                  <td>15000    </td>
                </tr>
                <tr>
                  <td>Std.Errors            </td>
                  <td>by: state</td>
                  <td>by: state</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>With the fully interacted model using relative time, you get the same slope parameters for year and year * treatment since there is no non-linearity in the slopes for either cohort, but the level parameters (intercept, treatment effect at year0, and cohort fixed effect) all will be different. You can then back out predictions for a fixed time post-intervention (e.g., 10 years), but this will obviously lead to extrapolation for the later treated cohort. Nevertheless this shows that the relative time model after eliminating overlap <em>can</em> recover estimates of the true treatment effects.</p>
</section>
<section id="hang-on" class="level2">
<h2 class="anchored" data-anchor-id="hang-on">Hang onâ€¦</h2>
<p>The big caveat to the last point above is that this only occurs under specific kinds of scenarios. In particular, the restricted, centered time approach â€˜worksâ€™ in recovering the true slopes in our prior example because the simulated trends are linear (though not identical across cohorts) in both of the pre- and post-treatment periods. Itâ€™s intuitive in the since that, if the trends are linear through the entire time, it shouldnâ€™t matter much whether you use 10 pre-periods or 5 pre-periods to estimate the pre-intervention slope (and vice versa for the post-intervention slope in the early treated cohort).</p>
<p>But this is a strong (and unnecessary) assumption. Plus, if there is non-linearity in the slopes then restricting the analysis to periods of overlap wonâ€™t actually help. Let simulate another example. The treatment effects are identical but now we introduce a small amount of non-linearity to the pre-intervention trends for the 2015 cohort.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4705</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># unit fixed effects (unobserved heterogeneity)</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>unit <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate clusters</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit_fe =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, state<span class="sc">/</span><span class="dv">10</span>, <span class="dv">1</span>),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate instantaneous treatment effect</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mu = rnorm(nobs, true_mu, 0.2)</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="dv">2</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># year fixed effects (first part)</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2001</span><span class="sc">:</span><span class="dv">2020</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_fe =</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(year), <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Put the clusters into treatment groups</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>treat_taus <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample the clusters randomly</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">30</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>),</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># place the randomly sampled states into 1\{t \ge g \}G_g</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">cohort_year =</span> <span class="fu">sort</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2010</span>, <span class="dv">2015</span>), <span class="at">times=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>)))</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co"># make main dataset</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="co"># full interaction of unit X year </span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>dtest2 <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">year =</span> <span class="dv">2001</span><span class="sc">:</span><span class="dv">2020</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., unit) <span class="sc">%&gt;%</span> </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., year) <span class="sc">%&gt;%</span> </span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., treat_taus) <span class="sc">%&gt;%</span> </span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make error term and get treatment indicators and treatment effects</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Also get cohort specific trends (modify time FE)</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">error =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span><span class="sc">*</span><span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat =</span> <span class="fu">ifelse</span>((year <span class="sc">&gt;=</span> </span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>           cohort_year), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>         <span class="co"># treatment effect = 2 if 2015, 1 if 2010, annually</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">mu =</span> <span class="fu">ifelse</span>(cohort_year<span class="sc">==</span><span class="dv">2015</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">tau =</span> <span class="fu">ifelse</span>(treat <span class="sc">==</span> <span class="dv">1</span>, mu, <span class="dv">0</span>),</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>         <span class="co"># year trends differ by cohort</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_fe =</span> <span class="fu">ifelse</span>(cohort_year<span class="sc">==</span><span class="dv">2015</span> <span class="sc">&amp;</span> year<span class="sc">&lt;</span><span class="dv">2005</span>,</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>          year_fe <span class="sc">+</span> (<span class="dv">2015</span> <span class="sc">-</span> cohort_year) <span class="sc">*</span> </span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>           (year <span class="sc">-</span> cohort_year) <span class="sc">/</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">12</span>,</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>          year_fe <span class="sc">+</span> (<span class="dv">2020</span> <span class="sc">-</span> cohort_year) <span class="sc">*</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>           (year <span class="sc">-</span> cohort_year) <span class="sc">/</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">20</span>)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate cumulative treatment effects</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(unit) <span class="sc">%&gt;%</span> </span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tau_cum =</span> <span class="fu">cumsum</span>(tau)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the dependent variable</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> (<span class="dv">2020</span> <span class="sc">-</span> cohort_year) <span class="sc">+</span> </span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>           unit_fe <span class="sc">+</span> year_fe <span class="sc">+</span> tau_cum <span class="sc">+</span> error) </span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Relabel 2018 cohort as never-treated</span></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(cohort_year = ifelse(cohort_year == 2018, Inf, cohort_year))</span></span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a><span class="co"># bring in simulated DiD dataset</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>dss <span class="ot">&lt;-</span> dtest2 <span class="sc">%&gt;%</span></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read_rds(here("data", </span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a> <span class="co">#"did-sim-data.rds")) %&gt;%</span></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year0 =</span> year <span class="sc">-</span> <span class="dv">2001</span>,</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">yearc =</span> year <span class="sc">-</span> cohort_year,</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">cohort_2015 =</span> <span class="fu">ifelse</span>(cohort_year <span class="sc">==</span> <span class="dv">2015</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is our new plot:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dss <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year0, <span class="at">y =</span> y, <span class="at">group =</span> unit)) <span class="sc">+</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dss <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cohort_year, year0) <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">mean</span>(y)),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">aes</span>(<span class="at">x =</span> year0, <span class="at">y =</span> y, <span class="at">group =</span> <span class="fu">factor</span>(cohort_year),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">factor</span>(cohort_year)), <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dss <span class="sc">%&gt;%</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year0) <span class="sc">%&gt;%</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">mean</span>(y)),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year0, <span class="at">y =</span> y, <span class="at">color =</span> <span class="st">"#4daf4a"</span>, <span class="at">group=</span><span class="st">"All"</span>), </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Y"</span>,  <span class="at">color =</span> <span class="st">"Treatment group   "</span>) <span class="sc">+</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">'#E41A1C'</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">15</span>, <span class="at">color =</span> <span class="st">'#377EB8'</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">'Set1'</span>, </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"2010"</span>, <span class="st">"2015"</span>, <span class="st">"Average"</span>)) <span class="sc">+</span> </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="its-sim_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this particular scenario, the non-linear part of the trend for the 2015 cohort is in the very early pre-period (everything else is the same), which means it wonâ€™t be captured when we have to restrict to years of overlap when using relative time. Here is a plot using relative time:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dss <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> yearc, <span class="at">y =</span> y, <span class="at">group =</span> unit)) <span class="sc">+</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> ds <span class="sc">%&gt;%</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cohort_year, yearc) <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">mean</span>(y)),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">aes</span>(<span class="at">x =</span> yearc, <span class="at">y =</span> y, <span class="at">group =</span> <span class="fu">factor</span>(cohort_year),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">factor</span>(cohort_year)), <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> ds <span class="sc">%&gt;%</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(yearc) <span class="sc">%&gt;%</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">mean</span>(y)),</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> yearc, <span class="at">y =</span> y, <span class="at">color =</span> <span class="st">"#4daf4a"</span>, <span class="at">group=</span><span class="st">"All"</span>), </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Y"</span>,  <span class="at">color =</span> <span class="st">"Treatment group   "</span>) <span class="sc">+</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'#984ea3'</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">'Set1'</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"2010"</span>, <span class="st">"2015"</span>, <span class="st">"Average"</span>)) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="its-sim_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This looks a lot like the plot from our earlier simulation. We wonâ€™t go through all of the prior models, but letâ€™s just compare what w</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
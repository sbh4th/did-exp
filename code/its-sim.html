<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ITS treatment considerations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="its-sim_files/libs/clipboard/clipboard.min.js"></script>
<script src="its-sim_files/libs/quarto-html/quarto.js"></script>
<script src="its-sim_files/libs/quarto-html/popper.min.js"></script>
<script src="its-sim_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="its-sim_files/libs/quarto-html/anchor.min.js"></script>
<link href="its-sim_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="its-sim_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="its-sim_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="its-sim_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="its-sim_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ITS treatment considerations</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="data-setup" class="level2">
<h2 class="anchored" data-anchor-id="data-setup">Data setup</h2>
<p>First let’s simulate some data. Although this is an ITS analysis that usually would have two time series, I’ve simulated a bunch of units for each treatment group to generate some sampling error. We’ll simulate 1000 observations from 30 different groups (e.g., states) over a period of 20 years, but in this case every single group is treated (i.e., there are no ‘never treated’ units.). There are two treatment cohorts that are treated at different times, one in 2010 and the other in 2015. The 2015 cohort is twice as large as the 2010 cohort, just to include some variation. Each group has both a different underlying secular trend and a different treatment effect.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(estimatr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tinytable)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed for reproducibility</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">48620</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># unit fixed effects (unobserved heterogeneity)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>unit <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate clusters</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit_fe =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, state<span class="sc">/</span><span class="dv">10</span>, <span class="dv">1</span>),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate instantaneous treatment effect</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mu = rnorm(nobs, true_mu, 0.2)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="dv">2</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># year fixed effects (first part)</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2001</span><span class="sc">:</span><span class="dv">2020</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_fe =</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(year), <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Put the clusters into treatment groups</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>treat_taus <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample the clusters randomly</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">30</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>),</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># place the randomly sampled states into 1\{t \ge g \}G_g</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">cohort_year =</span> <span class="fu">sort</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2010</span>, <span class="dv">2015</span>), <span class="at">times=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>)))</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"># make main dataset</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># full interaction of unit X year </span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>dtest <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">year =</span> <span class="dv">2001</span><span class="sc">:</span><span class="dv">2020</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., unit) <span class="sc">%&gt;%</span> </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., year) <span class="sc">%&gt;%</span> </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., treat_taus) <span class="sc">%&gt;%</span> </span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make error term and get treatment indicators and treatment effects</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Also get cohort specific trends (modify time FE)</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">error =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span><span class="sc">*</span><span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat =</span> <span class="fu">ifelse</span>((year <span class="sc">&gt;=</span> </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>           cohort_year), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>         <span class="co"># treatment effect = 3 if 2015, 6 if 2010, annually</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">mu =</span> <span class="fu">ifelse</span>(cohort_year<span class="sc">==</span><span class="dv">2015</span>, <span class="dv">4</span>, <span class="dv">1</span>),</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">tau =</span> <span class="fu">ifelse</span>(treat <span class="sc">==</span> <span class="dv">1</span>, mu, <span class="dv">0</span>),</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>         <span class="co"># year trends differ by cohort</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_fe =</span> year_fe <span class="sc">+</span> (<span class="dv">2020</span> <span class="sc">-</span> cohort_year) <span class="sc">*</span> </span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>           (year <span class="sc">-</span> cohort_year) <span class="sc">/</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">20</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate cumulative treatment effects</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(unit) <span class="sc">%&gt;%</span> </span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tau_cum =</span> <span class="fu">cumsum</span>(tau)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the dependent variable</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> (<span class="dv">2020</span> <span class="sc">-</span> cohort_year) <span class="sc">+</span> </span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>           unit_fe <span class="sc">+</span> year_fe <span class="sc">+</span> tau_cum <span class="sc">+</span> error) </span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Relabel 2018 cohort as never-treated</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(cohort_year = ifelse(cohort_year == 2018, Inf, cohort_year))</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co"># bring in simulated DiD dataset</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>ds <span class="ot">&lt;-</span> dtest <span class="sc">%&gt;%</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read_rds(here("data", </span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a> <span class="co">#"did-sim-data.rds")) %&gt;%</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year0 =</span> year <span class="sc">-</span> <span class="dv">2001</span>,</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">yearc =</span> year <span class="sc">-</span> cohort_year,</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">cohort_2015 =</span> <span class="fu">ifelse</span>(cohort_year <span class="sc">==</span> <span class="dv">2015</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is a plot of the simulated data, with the averages plotted for each cohort and the time of intervention marked on the graph. The specific treatment effects are 1 for the 2010 cohort and 4 for the 2015 cohort.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="its-sim_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="group-specific-analysis" class="level2">
<h2 class="anchored" data-anchor-id="group-specific-analysis">Group-specific analysis</h2>
<p>What is the causal effect of the intervention in the 2010 cohort?</p>
<p>Let’s do the ITS for the early treated cohort with a simple model like:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p><span class="math display">\[Y_{it} = \beta_{0} + \beta_{1}*year0 + \beta_{2}*treat + \beta_{3}*year0*treat + \epsilon_{it}\]</span></p>
<p>First, let’s estimate the models separately for each cohort. We’ll use the <code>lm_robust</code> function from <code>estimatr</code> to easily get cluster robust standard errors.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># models</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>m_c2010 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> year0 <span class="sc">*</span> treat, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">subset</span>(ds, cohort_year <span class="sc">==</span> <span class="dv">2010</span>), </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>m_c2015 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> year0 <span class="sc">*</span> treat, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">subset</span>(ds, cohort_year <span class="sc">==</span> <span class="dv">2015</span>), </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"2010 cohort"</span> <span class="ot">=</span> m_c2010,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"2015 cohort"</span> <span class="ot">=</span> m_c2015),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_2pw437uld38tfpdia68k(i, j, css_id) {
        var table = document.getElementById("tinytable_2pw437uld38tfpdia68k");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_2pw437uld38tfpdia68k');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_2pw437uld38tfpdia68k(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_2pw437uld38tfpdia68k");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(0, 0, 'tinytable_css_id1m6ow7rifl197gcyxmsv') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(0, 1, 'tinytable_css_idk2dlbl1p7i4d4y6lm2wg') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(0, 2, 'tinytable_css_idk2dlbl1p7i4d4y6lm2wg') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(0, 3, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(0, 4, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(0, 5, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(0, 6, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(1, 0, 'tinytable_css_id1cwd8lcwpzjifmdhxi1o') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(1, 1, 'tinytable_css_id5m07vib3numkkexwtcrz') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(1, 2, 'tinytable_css_id5m07vib3numkkexwtcrz') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(1, 3, 'tinytable_css_id5m07vib3numkkexwtcrz') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(1, 4, 'tinytable_css_id5m07vib3numkkexwtcrz') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(1, 5, 'tinytable_css_id5m07vib3numkkexwtcrz') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(1, 6, 'tinytable_css_id5m07vib3numkkexwtcrz') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(2, 0, 'tinytable_css_idlujhfkbdxgxtjcc4g5s5') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(2, 1, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(2, 2, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(2, 3, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(2, 4, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(2, 5, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(2, 6, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(3, 0, 'tinytable_css_idlujhfkbdxgxtjcc4g5s5') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(3, 1, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(3, 2, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(3, 3, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(3, 4, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(3, 5, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(3, 6, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(4, 0, 'tinytable_css_idlujhfkbdxgxtjcc4g5s5') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(4, 1, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(4, 2, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(4, 3, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(4, 4, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(4, 5, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(4, 6, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(5, 0, 'tinytable_css_idt0z6c9jucv5zbs0g8cr4') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(5, 1, 'tinytable_css_id96vsgjyoiq0iavfg96dj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(5, 2, 'tinytable_css_id96vsgjyoiq0iavfg96dj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(5, 3, 'tinytable_css_id96vsgjyoiq0iavfg96dj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(5, 4, 'tinytable_css_id96vsgjyoiq0iavfg96dj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(5, 5, 'tinytable_css_id96vsgjyoiq0iavfg96dj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(5, 6, 'tinytable_css_id96vsgjyoiq0iavfg96dj') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(6, 0, 'tinytable_css_idlujhfkbdxgxtjcc4g5s5') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(6, 1, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(6, 2, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(6, 3, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(6, 4, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(6, 5, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(6, 6, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(7, 0, 'tinytable_css_idlujhfkbdxgxtjcc4g5s5') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(7, 1, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(7, 2, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(7, 3, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(7, 4, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(7, 5, 'tinytable_css_idr378ssydfosavbah7uji') })
window.addEventListener('load', function () { styleCell_2pw437uld38tfpdia68k(7, 6, 'tinytable_css_idr378ssydfosavbah7uji') })
    </script>

    <style>
    .table td.tinytable_css_id1m6ow7rifl197gcyxmsv, .table th.tinytable_css_id1m6ow7rifl197gcyxmsv {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idk2dlbl1p7i4d4y6lm2wg, .table th.tinytable_css_idk2dlbl1p7i4d4y6lm2wg {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idr378ssydfosavbah7uji, .table th.tinytable_css_idr378ssydfosavbah7uji {  text-align: center; }
    .table td.tinytable_css_id1cwd8lcwpzjifmdhxi1o, .table th.tinytable_css_id1cwd8lcwpzjifmdhxi1o {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id5m07vib3numkkexwtcrz, .table th.tinytable_css_id5m07vib3numkkexwtcrz {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idlujhfkbdxgxtjcc4g5s5, .table th.tinytable_css_idlujhfkbdxgxtjcc4g5s5 {  text-align: left; }
    .table td.tinytable_css_idt0z6c9jucv5zbs0g8cr4, .table th.tinytable_css_idt0z6c9jucv5zbs0g8cr4 {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_id96vsgjyoiq0iavfg96dj, .table th.tinytable_css_id96vsgjyoiq0iavfg96dj {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_2pw437uld38tfpdia68k" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">2010 cohort</th>
<th scope="col" align="center" colspan="3">2015 cohort</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)  </td>
                  <td>12.97    </td>
                  <td>12.42</td>
                  <td>13.52</td>
                  <td>12.04    </td>
                  <td>11.60 </td>
                  <td>12.47 </td>
                </tr>
                <tr>
                  <td>year0        </td>
                  <td>2.03     </td>
                  <td>2.00 </td>
                  <td>2.05 </td>
                  <td>1.09     </td>
                  <td>1.08  </td>
                  <td>1.10  </td>
                </tr>
                <tr>
                  <td>treat        </td>
                  <td>-6.44    </td>
                  <td>-6.67</td>
                  <td>-6.21</td>
                  <td>-51.92   </td>
                  <td>-52.62</td>
                  <td>-51.21</td>
                </tr>
                <tr>
                  <td>year0 × treat</td>
                  <td>0.92     </td>
                  <td>0.89 </td>
                  <td>0.94 </td>
                  <td>3.95     </td>
                  <td>3.91  </td>
                  <td>3.99  </td>
                </tr>
                <tr>
                  <td>Num.Obs.     </td>
                  <td>6520     </td>
                  <td>     </td>
                  <td>     </td>
                  <td>13480    </td>
                  <td>      </td>
                  <td>      </td>
                </tr>
                <tr>
                  <td>Std.Errors   </td>
                  <td>by: state</td>
                  <td>     </td>
                  <td>     </td>
                  <td>by: state</td>
                  <td>      </td>
                  <td>      </td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>The slope estimates are basically what we specified (with sampling error) in the simulation (1 for the 2010 cohort and 4 for the 2015 cohort). Now let’s estimate the effect of the intervention at the end of follow-up, setting <code>year0=19</code> and estimating the difference by treatment status, using the <code>marginaleffects</code> package. We’ll estimate the average predictions under each treatment regime and then calculate the difference.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions for 2010 cohort</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>p_2010 <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_c2010, <span class="at">variables =</span> <span class="st">"treat"</span>, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>d_2010 <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(m_c2010, <span class="at">variables =</span> <span class="st">"treat"</span>, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>p_2010<span class="sc">$</span>term <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Untreated"</span>, <span class="st">"Treated"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>d_2010<span class="sc">$</span>term <span class="ot">=</span> <span class="st">"Difference"</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>p_2010 <span class="ot">&lt;-</span> p_2010 <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(d_2010)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions for 2015 cohort</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>p_2015 <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_c2015, <span class="at">variables =</span> <span class="st">"treat"</span>, </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>d_2015 <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(m_c2015, <span class="at">variables =</span> <span class="st">"treat"</span>, </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>))</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>p_2015<span class="sc">$</span>term <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Untreated"</span>, <span class="st">"Treated"</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>d_2015<span class="sc">$</span>term <span class="ot">=</span> <span class="st">"Difference"</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>p_2015 <span class="ot">&lt;-</span> p_2015 <span class="sc">%&gt;%</span> </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(d_2015)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"2010 cohort"</span> <span class="ot">=</span> p_2010,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2015 cohort"</span> <span class="ot">=</span> p_2015), <span class="at">fmt=</span><span class="dv">2</span>,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_gmkkigbckcm5lqhahtg5(i, j, css_id) {
        var table = document.getElementById("tinytable_gmkkigbckcm5lqhahtg5");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_gmkkigbckcm5lqhahtg5');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_gmkkigbckcm5lqhahtg5(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_gmkkigbckcm5lqhahtg5");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(0, 0, 'tinytable_css_idvfczw540wnkj3drb678o') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(0, 1, 'tinytable_css_idoqnjpg4062ccm7nqzcum') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(0, 2, 'tinytable_css_idoqnjpg4062ccm7nqzcum') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(1, 0, 'tinytable_css_idtc3b6r0malsq9n622co1') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(1, 1, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(1, 2, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(2, 0, 'tinytable_css_idtc3b6r0malsq9n622co1') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(2, 1, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(2, 2, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(3, 0, 'tinytable_css_idtc3b6r0malsq9n622co1') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(3, 1, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(3, 2, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(4, 0, 'tinytable_css_idtc3b6r0malsq9n622co1') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(4, 1, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(4, 2, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(5, 0, 'tinytable_css_idtc3b6r0malsq9n622co1') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(5, 1, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(5, 2, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(6, 0, 'tinytable_css_idgndf0itiljpibybystzo') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(6, 1, 'tinytable_css_iduuu0rtcu4nxow72184q2') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(6, 2, 'tinytable_css_iduuu0rtcu4nxow72184q2') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(7, 0, 'tinytable_css_idtc3b6r0malsq9n622co1') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(7, 1, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(7, 2, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(8, 0, 'tinytable_css_idtc3b6r0malsq9n622co1') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(8, 1, 'tinytable_css_idfgm6pe5emn92kon1t702') })
window.addEventListener('load', function () { styleCell_gmkkigbckcm5lqhahtg5(8, 2, 'tinytable_css_idfgm6pe5emn92kon1t702') })
    </script>

    <style>
    .table td.tinytable_css_idvfczw540wnkj3drb678o, .table th.tinytable_css_idvfczw540wnkj3drb678o {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idoqnjpg4062ccm7nqzcum, .table th.tinytable_css_idoqnjpg4062ccm7nqzcum {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idtc3b6r0malsq9n622co1, .table th.tinytable_css_idtc3b6r0malsq9n622co1 {  text-align: left; }
    .table td.tinytable_css_idfgm6pe5emn92kon1t702, .table th.tinytable_css_idfgm6pe5emn92kon1t702 {  text-align: center; }
    .table td.tinytable_css_idgndf0itiljpibybystzo, .table th.tinytable_css_idgndf0itiljpibybystzo {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_iduuu0rtcu4nxow72184q2, .table th.tinytable_css_iduuu0rtcu4nxow72184q2 {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_gmkkigbckcm5lqhahtg5" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">2010 cohort</th>
                <th scope="col">2015 cohort</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Untreated </td>
                  <td>51.48    </td>
                  <td>32.82    </td>
                </tr>
                <tr>
                  <td>          </td>
                  <td>(0.31)   </td>
                  <td>(0.23)   </td>
                </tr>
                <tr>
                  <td>Treated   </td>
                  <td>62.44    </td>
                  <td>55.95    </td>
                </tr>
                <tr>
                  <td>          </td>
                  <td>(0.28)   </td>
                  <td>(0.21)   </td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>10.97    </td>
                  <td>23.13    </td>
                </tr>
                <tr>
                  <td>          </td>
                  <td>(0.18)   </td>
                  <td>(0.08)   </td>
                </tr>
                <tr>
                  <td>Num.Obs.  </td>
                  <td>6520     </td>
                  <td>13480    </td>
                </tr>
                <tr>
                  <td>Std.Errors</td>
                  <td>by: state</td>
                  <td>by: state</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>So, we get predictions of 62.4 under treatment and 51.5 in the counterfactual absence of treatment for the 2010 cohort. The difference is 11. For the 2015 later-treated cohort, at the end of follow-up we get predictions of 55.9 under treatment and 32.8 in the counterfactual absence of treatment. The difference is 23.1. If we wanted to ignore any heterogeneity and just calculate an average causal effect at the end of follow-up, we can just take a weighted average of the cohort-specific effects.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>te <span class="ot">&lt;-</span> p_2010<span class="sc">$</span>estimate[<span class="dv">3</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> p_2015<span class="sc">$</span>estimate[<span class="dv">3</span>]<span class="sc">*</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The average causal effect in the population is 19.08.</p>
<p>In each of these cases it is clear that we are comparing each treated unit to itself to generate these counterfactual estimates. We can also use <code>marginaleffects</code> to get the average annual slopes (though redundant since these are linear models)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment slope for 2010 cohort</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>as_2010 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_c2010, <span class="at">variables =</span> <span class="st">"year0"</span>, <span class="at">by=</span><span class="st">"treat"</span>, <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Avg. slope"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># now for 2015 cohort</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>as_2015 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_c2015, <span class="at">variables =</span> <span class="st">"year0"</span>, <span class="at">by=</span><span class="st">"treat"</span>, <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Avg. slope"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"2010 cohort"</span> <span class="ot">=</span> as_2010,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2015 cohort"</span> <span class="ot">=</span> as_2015), <span class="at">fmt=</span><span class="dv">2</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"conf.int"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_l6uro2ur2bkaj7w5mxur(i, j, css_id) {
        var table = document.getElementById("tinytable_l6uro2ur2bkaj7w5mxur");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_l6uro2ur2bkaj7w5mxur');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_l6uro2ur2bkaj7w5mxur(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_l6uro2ur2bkaj7w5mxur");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_l6uro2ur2bkaj7w5mxur(0, 0, 'tinytable_css_id8sv5os5s7763t6dolh7f') })
window.addEventListener('load', function () { styleCell_l6uro2ur2bkaj7w5mxur(0, 1, 'tinytable_css_idij6sicjnu1f5pun3qm4g') })
window.addEventListener('load', function () { styleCell_l6uro2ur2bkaj7w5mxur(0, 2, 'tinytable_css_idij6sicjnu1f5pun3qm4g') })
window.addEventListener('load', function () { styleCell_l6uro2ur2bkaj7w5mxur(1, 0, 'tinytable_css_ido1ixrmj2yi69wjw1it7g') })
window.addEventListener('load', function () { styleCell_l6uro2ur2bkaj7w5mxur(1, 1, 'tinytable_css_idzmasb8uj6rsh9ry216vx') })
window.addEventListener('load', function () { styleCell_l6uro2ur2bkaj7w5mxur(1, 2, 'tinytable_css_idzmasb8uj6rsh9ry216vx') })
window.addEventListener('load', function () { styleCell_l6uro2ur2bkaj7w5mxur(2, 0, 'tinytable_css_ido1ixrmj2yi69wjw1it7g') })
window.addEventListener('load', function () { styleCell_l6uro2ur2bkaj7w5mxur(2, 1, 'tinytable_css_idzmasb8uj6rsh9ry216vx') })
window.addEventListener('load', function () { styleCell_l6uro2ur2bkaj7w5mxur(2, 2, 'tinytable_css_idzmasb8uj6rsh9ry216vx') })
    </script>

    <style>
    .table td.tinytable_css_id8sv5os5s7763t6dolh7f, .table th.tinytable_css_id8sv5os5s7763t6dolh7f {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idij6sicjnu1f5pun3qm4g, .table th.tinytable_css_idij6sicjnu1f5pun3qm4g {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_ido1ixrmj2yi69wjw1it7g, .table th.tinytable_css_ido1ixrmj2yi69wjw1it7g {  text-align: left; }
    .table td.tinytable_css_idzmasb8uj6rsh9ry216vx, .table th.tinytable_css_idzmasb8uj6rsh9ry216vx {  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_l6uro2ur2bkaj7w5mxur" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">2010 cohort</th>
                <th scope="col">2015 cohort</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Avg. slope</td>
                  <td>0.92        </td>
                  <td>3.95        </td>
                </tr>
                <tr>
                  <td>          </td>
                  <td>[0.89, 0.94]</td>
                  <td>[3.91, 3.99]</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Same values as shown for the <code>year0 x treat</code> variable in the table of model estimates above. Although we fit these models separately, we could hand calculate an overall averaged effect (ignoring cohort heterogeneity). The 2015 cohort is twice as large as the 2010 cohort, so a weighted average of the average treatment slopes above is (1/3) * 0.92 + (2/3) * 3.95, which is about 2.94.</p>
</section>
<section id="pooled-analysis-with-calendar-time" class="level2">
<h2 class="anchored" data-anchor-id="pooled-analysis-with-calendar-time">Pooled analysis with calendar time</h2>
<p>Now let’s analyze the entire cohort pooled together. Including a fixed effect for cohort in these models will only allow for an overall level shift, and if we include a product term between cohort and time, and cohort and the product term, we can recover the causal effects in both cohorts, or averaged over the entire period. Here are the model estimates:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>m_all <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(<span class="at">formula =</span> y <span class="sc">~</span> year0 <span class="sc">*</span> treat, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ds, <span class="at">clusters =</span> state)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>m_all_s <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(<span class="at">formula =</span> y <span class="sc">~</span> cohort_2015 <span class="sc">+</span> year0 <span class="sc">*</span> treat, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ds, <span class="at">clusters =</span> state)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>m_all_int <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(<span class="at">formula =</span> y <span class="sc">~</span> cohort_2015 <span class="sc">*</span> year0 <span class="sc">*</span> treat, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ds, <span class="at">clusters =</span> state)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"No cohort"</span> <span class="ot">=</span> m_all,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cohort FE"</span> <span class="ot">=</span> m_all_s, <span class="st">"Interactive"</span> <span class="ot">=</span> m_all_int),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_k5yxs32rvogh2fjw8fwd(i, j, css_id) {
        var table = document.getElementById("tinytable_k5yxs32rvogh2fjw8fwd");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_k5yxs32rvogh2fjw8fwd');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_k5yxs32rvogh2fjw8fwd(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_k5yxs32rvogh2fjw8fwd");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(0, 0, 'tinytable_css_id49vtuelf5mdrn4idmkz6') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(0, 1, 'tinytable_css_idq4wm4xjywif82yu6tlbs') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(0, 2, 'tinytable_css_idq4wm4xjywif82yu6tlbs') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(0, 3, 'tinytable_css_idq4wm4xjywif82yu6tlbs') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(1, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(1, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(1, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(1, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(2, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(2, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(2, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(2, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(3, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(3, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(3, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(3, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(4, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(4, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(4, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(4, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(5, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(5, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(5, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(5, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(6, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(6, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(6, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(6, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(7, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(7, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(7, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(7, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(8, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(8, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(8, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(8, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(9, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(9, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(9, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(9, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(10, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(10, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(10, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(10, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(11, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(11, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(11, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(11, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(12, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(12, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(12, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(12, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(13, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(13, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(13, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(13, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(14, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(14, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(14, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(14, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(15, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(15, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(15, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(15, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(16, 0, 'tinytable_css_idquk7wrxwe1v5ogiukmy1') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(16, 1, 'tinytable_css_idpjfr9z0xllaingzrsgu0') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(16, 2, 'tinytable_css_idpjfr9z0xllaingzrsgu0') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(16, 3, 'tinytable_css_idpjfr9z0xllaingzrsgu0') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(17, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(17, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(17, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(17, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(18, 0, 'tinytable_css_id1ct9fev5l0v1816y0vmf') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(18, 1, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(18, 2, 'tinytable_css_iduorlac8iy4o8rl433804') })
window.addEventListener('load', function () { styleCell_k5yxs32rvogh2fjw8fwd(18, 3, 'tinytable_css_iduorlac8iy4o8rl433804') })
    </script>

    <style>
    .table td.tinytable_css_id49vtuelf5mdrn4idmkz6, .table th.tinytable_css_id49vtuelf5mdrn4idmkz6 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idq4wm4xjywif82yu6tlbs, .table th.tinytable_css_idq4wm4xjywif82yu6tlbs {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id1ct9fev5l0v1816y0vmf, .table th.tinytable_css_id1ct9fev5l0v1816y0vmf {  text-align: left; }
    .table td.tinytable_css_iduorlac8iy4o8rl433804, .table th.tinytable_css_iduorlac8iy4o8rl433804 {  text-align: center; }
    .table td.tinytable_css_idquk7wrxwe1v5ogiukmy1, .table th.tinytable_css_idquk7wrxwe1v5ogiukmy1 {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idpjfr9z0xllaingzrsgu0, .table th.tinytable_css_idpjfr9z0xllaingzrsgu0 {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_k5yxs32rvogh2fjw8fwd" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">No cohort</th>
                <th scope="col">Cohort FE</th>
                <th scope="col">Interactive</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)                </td>
                  <td>13.39    </td>
                  <td>18.29    </td>
                  <td>12.97    </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>(0.36)   </td>
                  <td>(0.79)   </td>
                  <td>(0.28)   </td>
                </tr>
                <tr>
                  <td>year0                      </td>
                  <td>1.05     </td>
                  <td>1.30     </td>
                  <td>2.03     </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>(0.01)   </td>
                  <td>(0.05)   </td>
                  <td>(0.01)   </td>
                </tr>
                <tr>
                  <td>treat                      </td>
                  <td>-5.10    </td>
                  <td>-15.80   </td>
                  <td>-6.44    </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>(1.57)   </td>
                  <td>(2.80)   </td>
                  <td>(0.12)   </td>
                </tr>
                <tr>
                  <td>year0 × treat              </td>
                  <td>1.37     </td>
                  <td>1.79     </td>
                  <td>0.92     </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>(0.05)   </td>
                  <td>(0.17)   </td>
                  <td>(0.01)   </td>
                </tr>
                <tr>
                  <td>cohort_2015                </td>
                  <td>         </td>
                  <td>-8.37    </td>
                  <td>-0.93    </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>         </td>
                  <td>(0.43)   </td>
                  <td>(0.36)   </td>
                </tr>
                <tr>
                  <td>cohort_2015 × year0        </td>
                  <td>         </td>
                  <td>         </td>
                  <td>-0.93    </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>         </td>
                  <td>         </td>
                  <td>(0.01)   </td>
                </tr>
                <tr>
                  <td>cohort_2015 × treat        </td>
                  <td>         </td>
                  <td>         </td>
                  <td>-45.48   </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>         </td>
                  <td>         </td>
                  <td>(0.38)   </td>
                </tr>
                <tr>
                  <td>cohort_2015 × year0 × treat</td>
                  <td>         </td>
                  <td>         </td>
                  <td>3.03     </td>
                </tr>
                <tr>
                  <td>                           </td>
                  <td>         </td>
                  <td>         </td>
                  <td>(0.02)   </td>
                </tr>
                <tr>
                  <td>Num.Obs.                   </td>
                  <td>20000    </td>
                  <td>20000    </td>
                  <td>20000    </td>
                </tr>
                <tr>
                  <td>Std.Errors                 </td>
                  <td>by: state</td>
                  <td>by: state</td>
                  <td>by: state</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>If we use the interacted model we can recover the cohort-specific treatment effects at the end of follow-up above (again, setting <code>year0</code> to 19), as well as getting an overall average (although we probably wouldn’t want to ignore this kind of heterogeneity).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions at end of follow-up by treatment</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>m_all_int_ap <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_all_int, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>), </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment effects</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>m_all_int_te <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_all_int, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>), </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="fu">c</span>(<span class="st">"b2 - b1 = 0"</span>, <span class="st">"b4 - b3 = 0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"2010 cohort"</span>, <span class="st">"2015 cohort"</span>))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Marginal effects from interaction model"</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                  <span class="ot">=</span> m_all_int_te), <span class="at">fmt=</span><span class="dv">2</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"conf.int"</span>, <span class="at">shape =</span> term <span class="sc">~</span> statistic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_eeqz6n3jjl5eqoqvspfy(i, j, css_id) {
        var table = document.getElementById("tinytable_eeqz6n3jjl5eqoqvspfy");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_eeqz6n3jjl5eqoqvspfy');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_eeqz6n3jjl5eqoqvspfy(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_eeqz6n3jjl5eqoqvspfy");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(0, 0, 'tinytable_css_id5h4e5ybhjvmyjzrr7ewt') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(0, 1, 'tinytable_css_idxa6nm587kvg9r2v2eesm') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(0, 2, 'tinytable_css_idifn02syykdxcn0kp0ic2') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(0, 3, 'tinytable_css_idifn02syykdxcn0kp0ic2') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(1, 0, 'tinytable_css_idhbjou54qb5kvlm462ydk') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(1, 1, 'tinytable_css_idcv7lryg8ofqbawcsk68x') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(1, 2, 'tinytable_css_idcv7lryg8ofqbawcsk68x') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(1, 3, 'tinytable_css_idcv7lryg8ofqbawcsk68x') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(2, 0, 'tinytable_css_idyu81qbptbrn4nyt44qqn') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(2, 1, 'tinytable_css_idifn02syykdxcn0kp0ic2') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(2, 2, 'tinytable_css_idifn02syykdxcn0kp0ic2') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(2, 3, 'tinytable_css_idifn02syykdxcn0kp0ic2') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(3, 0, 'tinytable_css_idyu81qbptbrn4nyt44qqn') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(3, 1, 'tinytable_css_idifn02syykdxcn0kp0ic2') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(3, 2, 'tinytable_css_idifn02syykdxcn0kp0ic2') })
window.addEventListener('load', function () { styleCell_eeqz6n3jjl5eqoqvspfy(3, 3, 'tinytable_css_idifn02syykdxcn0kp0ic2') })
    </script>

    <style>
    .table td.tinytable_css_id5h4e5ybhjvmyjzrr7ewt, .table th.tinytable_css_id5h4e5ybhjvmyjzrr7ewt {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idxa6nm587kvg9r2v2eesm, .table th.tinytable_css_idxa6nm587kvg9r2v2eesm {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idifn02syykdxcn0kp0ic2, .table th.tinytable_css_idifn02syykdxcn0kp0ic2 {  text-align: center; }
    .table td.tinytable_css_idhbjou54qb5kvlm462ydk, .table th.tinytable_css_idhbjou54qb5kvlm462ydk {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idcv7lryg8ofqbawcsk68x, .table th.tinytable_css_idcv7lryg8ofqbawcsk68x {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idyu81qbptbrn4nyt44qqn, .table th.tinytable_css_idyu81qbptbrn4nyt44qqn {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_eeqz6n3jjl5eqoqvspfy" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Marginal effects from interaction model</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>2010 cohort</td>
                  <td>10.97</td>
                  <td>10.61</td>
                  <td>11.32</td>
                </tr>
                <tr>
                  <td>2015 cohort</td>
                  <td>23.13</td>
                  <td>22.98</td>
                  <td>23.28</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Same estimates that we calculated in the separate models above. Now for the average slopes:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># average slopes by treatment status</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>m_all_int_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_int, <span class="at">variable =</span> <span class="st">"year0"</span>, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>, <span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># average slope effects</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>m_all_int_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_int, <span class="at">variable =</span> <span class="st">"year0"</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="fu">c</span>(<span class="st">"b2 - b1 = 0"</span>, <span class="st">"b4 - b3 = 0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Difference"</span>, <span class="st">"Difference"</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">cohort_2015 =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>m_all_int_slopes <span class="ot">&lt;-</span> m_all_int_as <span class="sc">%&gt;%</span> </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_int_slope) <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cohort_2015 =</span> <span class="fu">factor</span>(cohort_2015,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"2010 cohort"</span>,<span class="st">"2015 cohort"</span>)))</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Average slopes: Interaction model"</span> </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>                  <span class="ot">=</span> m_all_int_slopes),</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> cohort_2015 <span class="sc">+</span> statistic,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_cdlnpggp1lhtyu9q86zp(i, j, css_id) {
        var table = document.getElementById("tinytable_cdlnpggp1lhtyu9q86zp");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_cdlnpggp1lhtyu9q86zp');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_cdlnpggp1lhtyu9q86zp(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_cdlnpggp1lhtyu9q86zp");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(0, 0, 'tinytable_css_idf0yxv9mnrwyvnkj4vxd8') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(0, 1, 'tinytable_css_idgpn2bj2sowm4w11pl99g') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(0, 2, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(0, 3, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(0, 4, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(0, 5, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(0, 6, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(1, 0, 'tinytable_css_idf0yxv9mnrwyvnkj4vxd8') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(1, 1, 'tinytable_css_idgpn2bj2sowm4w11pl99g') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(1, 2, 'tinytable_css_idgpn2bj2sowm4w11pl99g') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(1, 3, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(1, 4, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(1, 5, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(1, 6, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(2, 0, 'tinytable_css_idwffx9mehg1urot67o20y') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(2, 1, 'tinytable_css_iddrnlfhl16c6y6cizv61h') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(2, 2, 'tinytable_css_iddrnlfhl16c6y6cizv61h') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(2, 3, 'tinytable_css_iddrnlfhl16c6y6cizv61h') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(2, 4, 'tinytable_css_iddrnlfhl16c6y6cizv61h') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(2, 5, 'tinytable_css_iddrnlfhl16c6y6cizv61h') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(2, 6, 'tinytable_css_iddrnlfhl16c6y6cizv61h') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(3, 0, 'tinytable_css_iduxtblhsf7fdtw15cefkw') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(3, 1, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(3, 2, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(3, 3, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(3, 4, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(3, 5, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(3, 6, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(4, 0, 'tinytable_css_iduxtblhsf7fdtw15cefkw') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(4, 1, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(4, 2, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(4, 3, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(4, 4, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(4, 5, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(4, 6, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(5, 0, 'tinytable_css_iduxtblhsf7fdtw15cefkw') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(5, 1, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(5, 2, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(5, 3, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(5, 4, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(5, 5, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
window.addEventListener('load', function () { styleCell_cdlnpggp1lhtyu9q86zp(5, 6, 'tinytable_css_id4y44ztuwjvwbhc9ql3ff') })
    </script>

    <style>
    .table td.tinytable_css_idf0yxv9mnrwyvnkj4vxd8, .table th.tinytable_css_idf0yxv9mnrwyvnkj4vxd8 {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idgpn2bj2sowm4w11pl99g, .table th.tinytable_css_idgpn2bj2sowm4w11pl99g {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_id4y44ztuwjvwbhc9ql3ff, .table th.tinytable_css_id4y44ztuwjvwbhc9ql3ff {  text-align: center; }
    .table td.tinytable_css_idwffx9mehg1urot67o20y, .table th.tinytable_css_idwffx9mehg1urot67o20y {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_iddrnlfhl16c6y6cizv61h, .table th.tinytable_css_iddrnlfhl16c6y6cizv61h {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_iduxtblhsf7fdtw15cefkw, .table th.tinytable_css_iduxtblhsf7fdtw15cefkw {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_cdlnpggp1lhtyu9q86zp" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="6">Average slopes: Interaction model</th>
</tr>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">2010 cohort</th>
<th scope="col" align="center" colspan="3">2015 cohort</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Pre       </td>
                  <td>2.03</td>
                  <td>2.00</td>
                  <td>2.05</td>
                  <td>1.09</td>
                  <td>1.08</td>
                  <td>1.10</td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td>2.94</td>
                  <td>2.93</td>
                  <td>2.96</td>
                  <td>5.04</td>
                  <td>5.00</td>
                  <td>5.09</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>0.92</td>
                  <td>0.89</td>
                  <td>0.94</td>
                  <td>3.95</td>
                  <td>3.91</td>
                  <td>3.99</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Again, same as above.</p>
<p>As noted above, since the 2015 cohort is twice as large as the 2010 cohort, if we wanted an overall effect the weighted average effect can be derived by setting the value of <code>cohort_2015</code> to 0.67.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions at end of follow-up</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># averaging over the entire sample</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>m_all_int_aap <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_all_int, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>, <span class="at">cohort_2015 =</span> (<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Untreated"</span>, <span class="st">"Treated"</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># average treatment effect</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>m_all_int_ate <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(m_all_int, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>, <span class="at">cohort_2015 =</span> (<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>m_all_int_ates <span class="ot">&lt;-</span> m_all_int_aap <span class="sc">%&gt;%</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_int_ate)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Population average effect: interaction model"</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=</span> m_all_int_ates),</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">notes =</span> <span class="st">"Note: cohort fixed effect set to 2/3."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_2rzyxmud1oj9r9414nec(i, j, css_id) {
        var table = document.getElementById("tinytable_2rzyxmud1oj9r9414nec");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_2rzyxmud1oj9r9414nec');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_2rzyxmud1oj9r9414nec(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_2rzyxmud1oj9r9414nec");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(0, 0, 'tinytable_css_idqbjekiuogoph6bteppx4') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(0, 1, 'tinytable_css_idvxlzx9fptt2klda2us1w') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(0, 2, 'tinytable_css_idt4z4vqm2e3nsbnuyllia') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(0, 3, 'tinytable_css_idt4z4vqm2e3nsbnuyllia') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(1, 0, 'tinytable_css_id0ez6ingmfkt3qjilxc50') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(1, 1, 'tinytable_css_idghcmd8fvsaguoo76dfkn') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(1, 2, 'tinytable_css_idghcmd8fvsaguoo76dfkn') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(1, 3, 'tinytable_css_idghcmd8fvsaguoo76dfkn') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(2, 0, 'tinytable_css_idl4tl5ud4mxnwu5tzp4hn') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(2, 1, 'tinytable_css_idt4z4vqm2e3nsbnuyllia') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(2, 2, 'tinytable_css_idt4z4vqm2e3nsbnuyllia') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(2, 3, 'tinytable_css_idt4z4vqm2e3nsbnuyllia') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(3, 0, 'tinytable_css_idl4tl5ud4mxnwu5tzp4hn') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(3, 1, 'tinytable_css_idt4z4vqm2e3nsbnuyllia') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(3, 2, 'tinytable_css_idt4z4vqm2e3nsbnuyllia') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(3, 3, 'tinytable_css_idt4z4vqm2e3nsbnuyllia') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(4, 0, 'tinytable_css_idl4tl5ud4mxnwu5tzp4hn') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(4, 1, 'tinytable_css_idt4z4vqm2e3nsbnuyllia') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(4, 2, 'tinytable_css_idt4z4vqm2e3nsbnuyllia') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(4, 3, 'tinytable_css_idt4z4vqm2e3nsbnuyllia') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(5, 0, 'tinytable_css_idl4tl5ud4mxnwu5tzp4hn') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(5, 1, 'tinytable_css_idl4tl5ud4mxnwu5tzp4hn') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(5, 2, 'tinytable_css_idl4tl5ud4mxnwu5tzp4hn') })
window.addEventListener('load', function () { styleCell_2rzyxmud1oj9r9414nec(5, 3, 'tinytable_css_idl4tl5ud4mxnwu5tzp4hn') })
    </script>

    <style>
    .table td.tinytable_css_idqbjekiuogoph6bteppx4, .table th.tinytable_css_idqbjekiuogoph6bteppx4 {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idvxlzx9fptt2klda2us1w, .table th.tinytable_css_idvxlzx9fptt2klda2us1w {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idt4z4vqm2e3nsbnuyllia, .table th.tinytable_css_idt4z4vqm2e3nsbnuyllia {  text-align: center; }
    .table td.tinytable_css_id0ez6ingmfkt3qjilxc50, .table th.tinytable_css_id0ez6ingmfkt3qjilxc50 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idghcmd8fvsaguoo76dfkn, .table th.tinytable_css_idghcmd8fvsaguoo76dfkn {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idl4tl5ud4mxnwu5tzp4hn, .table th.tinytable_css_idl4tl5ud4mxnwu5tzp4hn {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_2rzyxmud1oj9r9414nec" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Population average effect: interaction model</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="4">Note: cohort fixed effect set to 2/3.</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>Untreated </td>
                  <td>39.04</td>
                  <td>38.67</td>
                  <td>39.40</td>
                </tr>
                <tr>
                  <td>Treated   </td>
                  <td>58.11</td>
                  <td>57.79</td>
                  <td>58.44</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>19.08</td>
                  <td>18.92</td>
                  <td>19.23</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Same average predictions and treatment effects as we calculated above. We can do the same for the slopes:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cohort-specific treatment effects</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>m_all_int_aas <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_int, <span class="at">variable =</span> <span class="st">"year0"</span>, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="fu">c</span>(<span class="st">"b2 - b1 = 0"</span>, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">"b4 - b3 = 0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"2010 cohort"</span>, <span class="st">"2015 cohort"</span>))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># weighted average of treatment slopes</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>m_all_int_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_int, </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="st">"year0"</span>, </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>), </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"(1/3)*(b2 - b1) + (2/3)*(b4 - b3) = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Average slope"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>m_all_int_aslope <span class="ot">&lt;-</span> m_all_int_aas <span class="sc">%&gt;%</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_int_slope)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Population average slope: interaction model"</span> </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>                  <span class="ot">=</span> m_all_int_aslope), <span class="at">fmt =</span> <span class="dv">2</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> statistic,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">notes =</span> <span class="st">"Note: 2015 cohort weighted by 2/3."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_yd8lc4fcqtrfl7rk2ypg(i, j, css_id) {
        var table = document.getElementById("tinytable_yd8lc4fcqtrfl7rk2ypg");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_yd8lc4fcqtrfl7rk2ypg');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_yd8lc4fcqtrfl7rk2ypg(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_yd8lc4fcqtrfl7rk2ypg");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(0, 0, 'tinytable_css_idyovm4qk15sxzotgsl7mr') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(0, 1, 'tinytable_css_idqtaihe356abiilds7cuq') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(0, 2, 'tinytable_css_idwjpllb4k7r7zg4j9el38') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(0, 3, 'tinytable_css_idwjpllb4k7r7zg4j9el38') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(1, 0, 'tinytable_css_idw5c6fwy3g3158dpgoz0e') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(1, 1, 'tinytable_css_idx2l2t1t4m28toibhpkxq') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(1, 2, 'tinytable_css_idx2l2t1t4m28toibhpkxq') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(1, 3, 'tinytable_css_idx2l2t1t4m28toibhpkxq') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(2, 0, 'tinytable_css_idd0688luu7o5hy70e7rpi') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(2, 1, 'tinytable_css_idwjpllb4k7r7zg4j9el38') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(2, 2, 'tinytable_css_idwjpllb4k7r7zg4j9el38') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(2, 3, 'tinytable_css_idwjpllb4k7r7zg4j9el38') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(3, 0, 'tinytable_css_idd0688luu7o5hy70e7rpi') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(3, 1, 'tinytable_css_idwjpllb4k7r7zg4j9el38') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(3, 2, 'tinytable_css_idwjpllb4k7r7zg4j9el38') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(3, 3, 'tinytable_css_idwjpllb4k7r7zg4j9el38') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(4, 0, 'tinytable_css_idd0688luu7o5hy70e7rpi') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(4, 1, 'tinytable_css_idwjpllb4k7r7zg4j9el38') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(4, 2, 'tinytable_css_idwjpllb4k7r7zg4j9el38') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(4, 3, 'tinytable_css_idwjpllb4k7r7zg4j9el38') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(5, 0, 'tinytable_css_idd0688luu7o5hy70e7rpi') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(5, 1, 'tinytable_css_idd0688luu7o5hy70e7rpi') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(5, 2, 'tinytable_css_idd0688luu7o5hy70e7rpi') })
window.addEventListener('load', function () { styleCell_yd8lc4fcqtrfl7rk2ypg(5, 3, 'tinytable_css_idd0688luu7o5hy70e7rpi') })
    </script>

    <style>
    .table td.tinytable_css_idyovm4qk15sxzotgsl7mr, .table th.tinytable_css_idyovm4qk15sxzotgsl7mr {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idqtaihe356abiilds7cuq, .table th.tinytable_css_idqtaihe356abiilds7cuq {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idwjpllb4k7r7zg4j9el38, .table th.tinytable_css_idwjpllb4k7r7zg4j9el38 {  text-align: center; }
    .table td.tinytable_css_idw5c6fwy3g3158dpgoz0e, .table th.tinytable_css_idw5c6fwy3g3158dpgoz0e {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idx2l2t1t4m28toibhpkxq, .table th.tinytable_css_idx2l2t1t4m28toibhpkxq {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idd0688luu7o5hy70e7rpi, .table th.tinytable_css_idd0688luu7o5hy70e7rpi {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_yd8lc4fcqtrfl7rk2ypg" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Population average slope: interaction model</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="4">Note: 2015 cohort weighted by 2/3.</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>2010 cohort  </td>
                  <td>0.92</td>
                  <td>0.89</td>
                  <td>0.94</td>
                </tr>
                <tr>
                  <td>2015 cohort  </td>
                  <td>3.95</td>
                  <td>3.91</td>
                  <td>3.99</td>
                </tr>
                <tr>
                  <td>Average slope</td>
                  <td>2.94</td>
                  <td>2.91</td>
                  <td>2.97</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Now what about the treatment effects for the other models? If we ignore cohort all together:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions at end of follow-up</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>m_all_ap <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_all, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Untreated"</span>, <span class="st">"Treated"</span>))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># effect of treatment</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>m_all_te <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(m_all, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># average slopes by treatment</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>m_all_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all, <span class="at">variables =</span> <span class="st">"year0"</span>, </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment slopes</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>m_all_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all, <span class="at">variables =</span> <span class="st">"year0"</span>, </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="st">"treat"</span>, <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>m_all_table <span class="ot">&lt;-</span> m_all_ap <span class="sc">%&gt;%</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_te, m_all_as, m_all_slope) <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, estimate, std.error, conf.low, conf.high)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(m_all_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">" "</span>, <span class="st">"Est."</span>, <span class="st">"SE"</span>, <span class="st">"2.5%"</span>, <span class="st">"97.5%"</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="fu">tt</span>(m_all_table, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_tt</span>(<span class="at">j =</span> <span class="fu">list</span>(<span class="st">"No cohort FE"</span> <span class="ot">=</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">i =</span> <span class="fu">list</span>(<span class="st">"Predictions at year 20"</span> <span class="ot">=</span> <span class="dv">1</span>, </span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Slope estimates"</span> <span class="ot">=</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_n3ekm4dix1akh6yl7fid(i, j, css_id) {
        var table = document.getElementById("tinytable_n3ekm4dix1akh6yl7fid");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow_3fqx1y01bfpao4i1q3tz(i, colspan, content) {
        var table = document.getElementById('tinytable_n3ekm4dix1akh6yl7fid');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_n3ekm4dix1akh6yl7fid(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_n3ekm4dix1akh6yl7fid");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { insertSpanRow_3fqx1y01bfpao4i1q3tz(5, 5, 'Slope estimates') });
window.addEventListener('load', function () { insertSpanRow_3fqx1y01bfpao4i1q3tz(2, 5, 'Predictions at year 20') });
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(0, 0, 'tinytable_css_idr81qadvjtakficmncsx5') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(0, 1, 'tinytable_css_id1xphj8jwxkawd0545yno') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(0, 2, 'tinytable_css_idr81qadvjtakficmncsx5') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(0, 3, 'tinytable_css_idr81qadvjtakficmncsx5') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(0, 4, 'tinytable_css_idr81qadvjtakficmncsx5') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(1, 0, 'tinytable_css_idrlmgxerz3r7pt2gt0mqt') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(1, 1, 'tinytable_css_idrlmgxerz3r7pt2gt0mqt') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(1, 2, 'tinytable_css_idrlmgxerz3r7pt2gt0mqt') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(1, 3, 'tinytable_css_idrlmgxerz3r7pt2gt0mqt') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(1, 4, 'tinytable_css_idrlmgxerz3r7pt2gt0mqt') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(3, 0, 'tinytable_css_idghd1vdz3pi4jda4mqqrn') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(4, 0, 'tinytable_css_idghd1vdz3pi4jda4mqqrn') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(5, 0, 'tinytable_css_idghd1vdz3pi4jda4mqqrn') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(7, 0, 'tinytable_css_idghd1vdz3pi4jda4mqqrn') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(8, 0, 'tinytable_css_idghd1vdz3pi4jda4mqqrn') })
window.addEventListener('load', function () { styleCell_n3ekm4dix1akh6yl7fid(9, 0, 'tinytable_css_idghd1vdz3pi4jda4mqqrn') })
    </script>

    <style>
    .table td.tinytable_css_idr81qadvjtakficmncsx5, .table th.tinytable_css_idr81qadvjtakficmncsx5 {  text-align: center; }
    .table td.tinytable_css_id1xphj8jwxkawd0545yno, .table th.tinytable_css_id1xphj8jwxkawd0545yno {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idrlmgxerz3r7pt2gt0mqt, .table th.tinytable_css_idrlmgxerz3r7pt2gt0mqt {  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idghd1vdz3pi4jda4mqqrn, .table th.tinytable_css_idghd1vdz3pi4jda4mqqrn { padding-left: 1em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_n3ekm4dix1akh6yl7fid" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="4">No cohort FE</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">SE</th>
                <th scope="col">2.5%</th>
                <th scope="col">97.5%</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Untreated </td>
                  <td>33.4</td>
                  <td>0.409</td>
                  <td>32.6</td>
                  <td>34.2</td>
                </tr>
                <tr>
                  <td>Treated   </td>
                  <td>54.3</td>
                  <td>0.858</td>
                  <td>52.6</td>
                  <td>56  </td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>20.9</td>
                  <td>0.544</td>
                  <td>19.9</td>
                  <td>22  </td>
                </tr>
                <tr>
                  <td>Pre       </td>
                  <td> 1.1</td>
                  <td>0.011</td>
                  <td> 1  </td>
                  <td> 1.1</td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td> 2.4</td>
                  <td>0.059</td>
                  <td> 2.3</td>
                  <td> 2.5</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td> 1.4</td>
                  <td>0.055</td>
                  <td> 1.3</td>
                  <td> 1.5</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Not right. If the true impacts are an average effect of 19.08 by the end of follow-up and an average slope of 2.94, these estimates are not correct. What happens if we just condition on cohort without allowing for separate treatment effects?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions at end of follow-up</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>m_all_s_ap <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_all_s, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cohort_2015 =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Untreated"</span>,<span class="st">"Treated"</span>))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># effect of treatment at end of follow-up</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>m_all_s_te <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(m_all_s, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">year0 =</span> <span class="dv">19</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cohort_2015 =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># average slope</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>m_all_s_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_s, </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"year0"</span>, <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment effect</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>m_all_s_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_s, <span class="at">variables =</span> <span class="st">"year0"</span>, </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="st">"treat"</span>, <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>m_all_s_table <span class="ot">&lt;-</span> m_all_s_ap <span class="sc">%&gt;%</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_s_te, m_all_s_as, m_all_s_slope) <span class="sc">%&gt;%</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, estimate, std.error, conf.low, conf.high)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(m_all_s_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">" "</span>, <span class="st">"Est."</span>, <span class="st">"SE"</span>, <span class="st">"2.5%"</span>, <span class="st">"97.5%"</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="fu">tt</span>(m_all_s_table, <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>   <span class="at">notes =</span> <span class="st">"Note: Cohort set to 2/3 for predictions"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_tt</span>(<span class="at">j =</span> <span class="fu">list</span>(<span class="st">"With cohort FE"</span> <span class="ot">=</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">i =</span> <span class="fu">list</span>(<span class="st">"Predictions at year 20"</span> <span class="ot">=</span> <span class="dv">1</span>, </span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Slope estimates"</span> <span class="ot">=</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_sgotigoi9fqgzmpixwub(i, j, css_id) {
        var table = document.getElementById("tinytable_sgotigoi9fqgzmpixwub");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow_vrbz14l52nxizyjkh47k(i, colspan, content) {
        var table = document.getElementById('tinytable_sgotigoi9fqgzmpixwub');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_sgotigoi9fqgzmpixwub(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_sgotigoi9fqgzmpixwub");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { insertSpanRow_vrbz14l52nxizyjkh47k(5, 5, 'Slope estimates') });
window.addEventListener('load', function () { insertSpanRow_vrbz14l52nxizyjkh47k(2, 5, 'Predictions at year 20') });
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(0, 0, 'tinytable_css_id77qd0uctjmu5zeoevm3g') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(0, 1, 'tinytable_css_idlb7q7i6gh03bx22noyrg') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(0, 2, 'tinytable_css_id77qd0uctjmu5zeoevm3g') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(0, 3, 'tinytable_css_id77qd0uctjmu5zeoevm3g') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(0, 4, 'tinytable_css_id77qd0uctjmu5zeoevm3g') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(1, 0, 'tinytable_css_id5k5atkk31pgclvo98eko') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(1, 1, 'tinytable_css_id5k5atkk31pgclvo98eko') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(1, 2, 'tinytable_css_id5k5atkk31pgclvo98eko') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(1, 3, 'tinytable_css_id5k5atkk31pgclvo98eko') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(1, 4, 'tinytable_css_id5k5atkk31pgclvo98eko') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(3, 0, 'tinytable_css_id59gkjkdvlrv3xxihbim8') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(4, 0, 'tinytable_css_id59gkjkdvlrv3xxihbim8') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(5, 0, 'tinytable_css_id59gkjkdvlrv3xxihbim8') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(7, 0, 'tinytable_css_id59gkjkdvlrv3xxihbim8') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(8, 0, 'tinytable_css_id59gkjkdvlrv3xxihbim8') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(9, 0, 'tinytable_css_id59gkjkdvlrv3xxihbim8') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(10, 0, 'tinytable_css_id94eqz7ntgybywy1ifoyn') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(10, 1, 'tinytable_css_id94eqz7ntgybywy1ifoyn') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(10, 2, 'tinytable_css_id94eqz7ntgybywy1ifoyn') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(10, 3, 'tinytable_css_id94eqz7ntgybywy1ifoyn') })
window.addEventListener('load', function () { styleCell_sgotigoi9fqgzmpixwub(10, 4, 'tinytable_css_id94eqz7ntgybywy1ifoyn') })
    </script>

    <style>
    .table td.tinytable_css_id77qd0uctjmu5zeoevm3g, .table th.tinytable_css_id77qd0uctjmu5zeoevm3g {  text-align: center; }
    .table td.tinytable_css_idlb7q7i6gh03bx22noyrg, .table th.tinytable_css_idlb7q7i6gh03bx22noyrg {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_id5k5atkk31pgclvo98eko, .table th.tinytable_css_id5k5atkk31pgclvo98eko {  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id59gkjkdvlrv3xxihbim8, .table th.tinytable_css_id59gkjkdvlrv3xxihbim8 { padding-left: 1em; }
    .table td.tinytable_css_id94eqz7ntgybywy1ifoyn, .table th.tinytable_css_id94eqz7ntgybywy1ifoyn {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_sgotigoi9fqgzmpixwub" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="4">With cohort FE</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">SE</th>
                <th scope="col">2.5%</th>
                <th scope="col">97.5%</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="5">Note: Cohort set to 2/3 for predictions</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>Untreated </td>
                  <td>37.5</td>
                  <td>0.462</td>
                  <td>36.6</td>
                  <td>38.4</td>
                </tr>
                <tr>
                  <td>Treated   </td>
                  <td>55.6</td>
                  <td>0.176</td>
                  <td>55.3</td>
                  <td>56  </td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>18.2</td>
                  <td>0.473</td>
                  <td>17.2</td>
                  <td>19.1</td>
                </tr>
                <tr>
                  <td>Pre       </td>
                  <td> 1.3</td>
                  <td>0.053</td>
                  <td> 1.2</td>
                  <td> 1.4</td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td> 3.1</td>
                  <td>0.119</td>
                  <td> 2.9</td>
                  <td> 3.3</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td> 1.8</td>
                  <td>0.172</td>
                  <td> 1.4</td>
                  <td> 2.1</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>This is a little better but generally still not correct, which is perhaps not that surprising since simply adding a cohort fixed effect only allows for a level shift.</p>
</section>
<section id="relative-time" class="level2">
<h2 class="anchored" data-anchor-id="relative-time">Relative time</h2>
<p>Now let’s work with relative time. First, let’s plot the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ds <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> yearc, <span class="at">y =</span> y, <span class="at">group =</span> unit)) <span class="sc">+</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> ds <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cohort_year, yearc) <span class="sc">%&gt;%</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">mean</span>(y)),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">aes</span>(<span class="at">x =</span> yearc, <span class="at">y =</span> y, <span class="at">group =</span> <span class="fu">factor</span>(cohort_year),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">factor</span>(cohort_year)), <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> ds <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(yearc) <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">mean</span>(y)),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> yearc, <span class="at">y =</span> y, <span class="at">color =</span> <span class="st">"#4daf4a"</span>, <span class="at">group=</span><span class="st">"All"</span>), </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Y"</span>,  <span class="at">color =</span> <span class="st">"Treatment group   "</span>) <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'#984ea3'</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">'Set1'</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"2010"</span>, <span class="st">"2015"</span>, <span class="st">"Average"</span>)) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="its-sim_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Yeah, this looks a little strange, and you can see that of course the average slope in the early period is only coming from the 2015 cohort, and the slope in the later post period is only coming from the 2010 cohort.</p>
<p>Let’s start with the model that has no cohort fixed effects.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>m_all_c <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> yearc <span class="sc">*</span> treat, <span class="at">data=</span>ds, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>m_all_c_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_c, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>m_all_c_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_c, </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>m_all_c_slopes <span class="ot">&lt;-</span> m_all_c_as <span class="sc">%&gt;%</span> </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_c_slope)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Average slopes: No cohort"</span> <span class="ot">=</span> m_all_c_slopes),</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_ed2czq0j73psjrlrj08d(i, j, css_id) {
        var table = document.getElementById("tinytable_ed2czq0j73psjrlrj08d");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_ed2czq0j73psjrlrj08d');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_ed2czq0j73psjrlrj08d(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_ed2czq0j73psjrlrj08d");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(0, 0, 'tinytable_css_idglq01qe2mjm4p8veret6') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(0, 1, 'tinytable_css_idlbdnftu0xeamiqak79s6') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(0, 2, 'tinytable_css_ido997c1nb0lmvui6xf6n8') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(0, 3, 'tinytable_css_ido997c1nb0lmvui6xf6n8') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(1, 0, 'tinytable_css_ids3kijlgb9v5ou23b0ry3') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(1, 1, 'tinytable_css_idgquo29lt1ms46huh2du9') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(1, 2, 'tinytable_css_idgquo29lt1ms46huh2du9') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(1, 3, 'tinytable_css_idgquo29lt1ms46huh2du9') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(2, 0, 'tinytable_css_idw5tz2nccbzts1k80c6pb') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(2, 1, 'tinytable_css_ido997c1nb0lmvui6xf6n8') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(2, 2, 'tinytable_css_ido997c1nb0lmvui6xf6n8') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(2, 3, 'tinytable_css_ido997c1nb0lmvui6xf6n8') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(3, 0, 'tinytable_css_idw5tz2nccbzts1k80c6pb') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(3, 1, 'tinytable_css_ido997c1nb0lmvui6xf6n8') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(3, 2, 'tinytable_css_ido997c1nb0lmvui6xf6n8') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(3, 3, 'tinytable_css_ido997c1nb0lmvui6xf6n8') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(4, 0, 'tinytable_css_idw5tz2nccbzts1k80c6pb') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(4, 1, 'tinytable_css_ido997c1nb0lmvui6xf6n8') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(4, 2, 'tinytable_css_ido997c1nb0lmvui6xf6n8') })
window.addEventListener('load', function () { styleCell_ed2czq0j73psjrlrj08d(4, 3, 'tinytable_css_ido997c1nb0lmvui6xf6n8') })
    </script>

    <style>
    .table td.tinytable_css_idglq01qe2mjm4p8veret6, .table th.tinytable_css_idglq01qe2mjm4p8veret6 {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idlbdnftu0xeamiqak79s6, .table th.tinytable_css_idlbdnftu0xeamiqak79s6 {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_ido997c1nb0lmvui6xf6n8, .table th.tinytable_css_ido997c1nb0lmvui6xf6n8 {  text-align: center; }
    .table td.tinytable_css_ids3kijlgb9v5ou23b0ry3, .table th.tinytable_css_ids3kijlgb9v5ou23b0ry3 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idgquo29lt1ms46huh2du9, .table th.tinytable_css_idgquo29lt1ms46huh2du9 {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idw5tz2nccbzts1k80c6pb, .table th.tinytable_css_idw5tz2nccbzts1k80c6pb {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_ed2czq0j73psjrlrj08d" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Average slopes: No cohort</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Pre       </td>
                  <td>1.17</td>
                  <td>1.11</td>
                  <td>1.22</td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td>3.12</td>
                  <td>2.91</td>
                  <td>3.34</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>1.95</td>
                  <td>1.69</td>
                  <td>2.22</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>This gives us biased estimates slope effects (recall that the average slope should be 2.94). Moreover, since we are now working with relative time we can’t specify the treatment effect at the end of follow-up, we have to specify a relative time. But this means either extrapolating beyond the observed data for the later-treated cohort (if we set the centered year variable (<code>yearc</code>) to 10 years post), or shortening the time horizon for the early treated cohort (if we set <code>yearc</code> to 5). Here are the estimated predictions and treatment effects at year 10 post intervention:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions at 10 years of follow up</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>m_all_c_ap <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(m_all_c, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">yearc =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Untreated"</span>,<span class="st">"Treated"</span>))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># effect of treatment</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>m_all_c_te <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(m_all_c, <span class="at">variable =</span> <span class="st">"treat"</span>, </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">yearc =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>m_all_c_ate <span class="ot">&lt;-</span> m_all_c_ap <span class="sc">%&gt;%</span> </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_c_te)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"No cohort fixed effect"</span> </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=</span> m_all_c_ate),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">notes =</span> <span class="st">"Note: predictions 10-years post intervention"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_rq2lenv5u470ahopwt12(i, j, css_id) {
        var table = document.getElementById("tinytable_rq2lenv5u470ahopwt12");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_rq2lenv5u470ahopwt12');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_rq2lenv5u470ahopwt12(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_rq2lenv5u470ahopwt12");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(0, 0, 'tinytable_css_idma94f8uhtdbluzivgd1j') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(0, 1, 'tinytable_css_id911vqsrvryps3uwmhbve') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(0, 2, 'tinytable_css_idzxmjui9n2fyjvwlcmwiz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(0, 3, 'tinytable_css_idzxmjui9n2fyjvwlcmwiz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(1, 0, 'tinytable_css_id448uzwomy2q73ca21c9b') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(1, 1, 'tinytable_css_id9ibespidxn8xiuxcziaw') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(1, 2, 'tinytable_css_id9ibespidxn8xiuxcziaw') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(1, 3, 'tinytable_css_id9ibespidxn8xiuxcziaw') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(2, 0, 'tinytable_css_idaykc38talm13s2yzzyuz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(2, 1, 'tinytable_css_idzxmjui9n2fyjvwlcmwiz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(2, 2, 'tinytable_css_idzxmjui9n2fyjvwlcmwiz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(2, 3, 'tinytable_css_idzxmjui9n2fyjvwlcmwiz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(3, 0, 'tinytable_css_idaykc38talm13s2yzzyuz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(3, 1, 'tinytable_css_idzxmjui9n2fyjvwlcmwiz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(3, 2, 'tinytable_css_idzxmjui9n2fyjvwlcmwiz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(3, 3, 'tinytable_css_idzxmjui9n2fyjvwlcmwiz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(4, 0, 'tinytable_css_idaykc38talm13s2yzzyuz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(4, 1, 'tinytable_css_idzxmjui9n2fyjvwlcmwiz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(4, 2, 'tinytable_css_idzxmjui9n2fyjvwlcmwiz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(4, 3, 'tinytable_css_idzxmjui9n2fyjvwlcmwiz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(5, 0, 'tinytable_css_idaykc38talm13s2yzzyuz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(5, 1, 'tinytable_css_idaykc38talm13s2yzzyuz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(5, 2, 'tinytable_css_idaykc38talm13s2yzzyuz') })
window.addEventListener('load', function () { styleCell_rq2lenv5u470ahopwt12(5, 3, 'tinytable_css_idaykc38talm13s2yzzyuz') })
    </script>

    <style>
    .table td.tinytable_css_idma94f8uhtdbluzivgd1j, .table th.tinytable_css_idma94f8uhtdbluzivgd1j {  text-align: center;  text-align: left; }
    .table td.tinytable_css_id911vqsrvryps3uwmhbve, .table th.tinytable_css_id911vqsrvryps3uwmhbve {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idzxmjui9n2fyjvwlcmwiz, .table th.tinytable_css_idzxmjui9n2fyjvwlcmwiz {  text-align: center; }
    .table td.tinytable_css_id448uzwomy2q73ca21c9b, .table th.tinytable_css_id448uzwomy2q73ca21c9b {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id9ibespidxn8xiuxcziaw, .table th.tinytable_css_id9ibespidxn8xiuxcziaw {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idaykc38talm13s2yzzyuz, .table th.tinytable_css_idaykc38talm13s2yzzyuz {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_rq2lenv5u470ahopwt12" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">No cohort fixed effect</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="4">Note: predictions 10-years post intervention</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>Untreated </td>
                  <td>39.34</td>
                  <td>38.51</td>
                  <td>40.16</td>
                </tr>
                <tr>
                  <td>Treated   </td>
                  <td>65.15</td>
                  <td>63.07</td>
                  <td>67.23</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>25.81</td>
                  <td>23.08</td>
                  <td>28.54</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Okay, now we get an estimate of 25.81. Recall that the overall average effect at the end of follow-up was `19.08. Obviously extrapolation is having some consequence here.</p>
<p>Let’s add a cohort fixed effect and look at the estimated slope effect:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>m_all_cs <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> cohort_2015 <span class="sc">+</span> yearc <span class="sc">*</span> treat, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>ds, <span class="at">clusters =</span> state)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>m_all_cs_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_cs, </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>m_all_cs_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_cs, </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>m_all_cs_slopes <span class="ot">&lt;-</span> m_all_cs_as <span class="sc">%&gt;%</span> </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_cs_slope)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Average slopes: Cohort FE"</span> </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>                   <span class="ot">=</span> m_all_cs_slopes),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_8xhveefqfa7pfmi2mtie(i, j, css_id) {
        var table = document.getElementById("tinytable_8xhveefqfa7pfmi2mtie");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_8xhveefqfa7pfmi2mtie');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_8xhveefqfa7pfmi2mtie(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_8xhveefqfa7pfmi2mtie");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(0, 0, 'tinytable_css_id5y7oqsz0untm1whkyayg') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(0, 1, 'tinytable_css_id81ui4fr6pscbxcwa1alk') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(0, 2, 'tinytable_css_idxsmztqsx486mroy054bb') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(0, 3, 'tinytable_css_idxsmztqsx486mroy054bb') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(1, 0, 'tinytable_css_idv595cd9pzsrksgveg616') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(1, 1, 'tinytable_css_idnncwl8m405mlojkn15mo') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(1, 2, 'tinytable_css_idnncwl8m405mlojkn15mo') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(1, 3, 'tinytable_css_idnncwl8m405mlojkn15mo') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(2, 0, 'tinytable_css_id2xvqn9mi2tfj4gsrycia') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(2, 1, 'tinytable_css_idxsmztqsx486mroy054bb') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(2, 2, 'tinytable_css_idxsmztqsx486mroy054bb') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(2, 3, 'tinytable_css_idxsmztqsx486mroy054bb') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(3, 0, 'tinytable_css_id2xvqn9mi2tfj4gsrycia') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(3, 1, 'tinytable_css_idxsmztqsx486mroy054bb') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(3, 2, 'tinytable_css_idxsmztqsx486mroy054bb') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(3, 3, 'tinytable_css_idxsmztqsx486mroy054bb') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(4, 0, 'tinytable_css_id2xvqn9mi2tfj4gsrycia') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(4, 1, 'tinytable_css_idxsmztqsx486mroy054bb') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(4, 2, 'tinytable_css_idxsmztqsx486mroy054bb') })
window.addEventListener('load', function () { styleCell_8xhveefqfa7pfmi2mtie(4, 3, 'tinytable_css_idxsmztqsx486mroy054bb') })
    </script>

    <style>
    .table td.tinytable_css_id5y7oqsz0untm1whkyayg, .table th.tinytable_css_id5y7oqsz0untm1whkyayg {  text-align: center;  text-align: left; }
    .table td.tinytable_css_id81ui4fr6pscbxcwa1alk, .table th.tinytable_css_id81ui4fr6pscbxcwa1alk {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idxsmztqsx486mroy054bb, .table th.tinytable_css_idxsmztqsx486mroy054bb {  text-align: center; }
    .table td.tinytable_css_idv595cd9pzsrksgveg616, .table th.tinytable_css_idv595cd9pzsrksgveg616 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idnncwl8m405mlojkn15mo, .table th.tinytable_css_idnncwl8m405mlojkn15mo {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id2xvqn9mi2tfj4gsrycia, .table th.tinytable_css_id2xvqn9mi2tfj4gsrycia {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_8xhveefqfa7pfmi2mtie" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Average slopes: Cohort FE</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Pre       </td>
                  <td>1.24</td>
                  <td>1.16</td>
                  <td>1.32</td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td>3.32</td>
                  <td>3.06</td>
                  <td>3.57</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>2.08</td>
                  <td>1.74</td>
                  <td>2.41</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Our estimate is now 2.08, compared to the true estimate of 2.94.</p>
<p>Now let’s limit our comparisons to only the years where we have sufficient overlap of years once we center things (i.e., where <code>yearc</code> &gt;= -9 or &lt;= 5). Here is a plot of the restricted data:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="its-sim_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here are the models using relative time, with and without a cohort fixed effect:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>m_all_cr <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> yearc <span class="sc">*</span> treat, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span><span class="fu">subset</span>(ds, yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>), </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>m_all_crs <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> cohort_2015 <span class="sc">+</span> yearc <span class="sc">*</span> treat, </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span><span class="fu">subset</span>(ds, yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>), </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"No cohort"</span> <span class="ot">=</span> m_all_cr,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cohort FE"</span> <span class="ot">=</span> m_all_crs),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_yi69wjw1it7gij6sicjn(i, j, css_id) {
        var table = document.getElementById("tinytable_yi69wjw1it7gij6sicjn");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_yi69wjw1it7gij6sicjn');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_yi69wjw1it7gij6sicjn(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_yi69wjw1it7gij6sicjn");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(0, 0, 'tinytable_css_idv95fwaw3jwjgpzgbz9hd') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(0, 1, 'tinytable_css_idn7079w9hcxcpps64hqsu') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(0, 2, 'tinytable_css_idn7079w9hcxcpps64hqsu') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(1, 0, 'tinytable_css_idetpzimpd8lwsw01wckwf') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(1, 1, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(1, 2, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(2, 0, 'tinytable_css_idetpzimpd8lwsw01wckwf') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(2, 1, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(2, 2, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(3, 0, 'tinytable_css_idetpzimpd8lwsw01wckwf') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(3, 1, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(3, 2, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(4, 0, 'tinytable_css_idetpzimpd8lwsw01wckwf') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(4, 1, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(4, 2, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(5, 0, 'tinytable_css_idetpzimpd8lwsw01wckwf') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(5, 1, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(5, 2, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(6, 0, 'tinytable_css_idetpzimpd8lwsw01wckwf') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(6, 1, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(6, 2, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(7, 0, 'tinytable_css_idetpzimpd8lwsw01wckwf') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(7, 1, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(7, 2, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(8, 0, 'tinytable_css_idetpzimpd8lwsw01wckwf') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(8, 1, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(8, 2, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(9, 0, 'tinytable_css_idetpzimpd8lwsw01wckwf') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(9, 1, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(9, 2, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(10, 0, 'tinytable_css_idigaavu79zr4mn4fcl0jy') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(10, 1, 'tinytable_css_idkuosndmhd5iwxi949vtu') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(10, 2, 'tinytable_css_idkuosndmhd5iwxi949vtu') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(11, 0, 'tinytable_css_idetpzimpd8lwsw01wckwf') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(11, 1, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(11, 2, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(12, 0, 'tinytable_css_idetpzimpd8lwsw01wckwf') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(12, 1, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
window.addEventListener('load', function () { styleCell_yi69wjw1it7gij6sicjn(12, 2, 'tinytable_css_idtqgbo4tta5ejxek8zx9o') })
    </script>

    <style>
    .table td.tinytable_css_idv95fwaw3jwjgpzgbz9hd, .table th.tinytable_css_idv95fwaw3jwjgpzgbz9hd {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idn7079w9hcxcpps64hqsu, .table th.tinytable_css_idn7079w9hcxcpps64hqsu {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idetpzimpd8lwsw01wckwf, .table th.tinytable_css_idetpzimpd8lwsw01wckwf {  text-align: left; }
    .table td.tinytable_css_idtqgbo4tta5ejxek8zx9o, .table th.tinytable_css_idtqgbo4tta5ejxek8zx9o {  text-align: center; }
    .table td.tinytable_css_idigaavu79zr4mn4fcl0jy, .table th.tinytable_css_idigaavu79zr4mn4fcl0jy {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idkuosndmhd5iwxi949vtu, .table th.tinytable_css_idkuosndmhd5iwxi949vtu {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_yi69wjw1it7gij6sicjn" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">No cohort</th>
                <th scope="col">Cohort FE</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)  </td>
                  <td>28.65    </td>
                  <td>37.94    </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.36)   </td>
                  <td>(0.95)   </td>
                </tr>
                <tr>
                  <td>yearc        </td>
                  <td>1.41     </td>
                  <td>1.41     </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.08)   </td>
                  <td>(0.08)   </td>
                </tr>
                <tr>
                  <td>treat        </td>
                  <td>-1.58    </td>
                  <td>-1.58    </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.84)   </td>
                  <td>(0.84)   </td>
                </tr>
                <tr>
                  <td>yearc × treat</td>
                  <td>-1.45    </td>
                  <td>-1.45    </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.71)   </td>
                  <td>(0.71)   </td>
                </tr>
                <tr>
                  <td>cohort_2015  </td>
                  <td>         </td>
                  <td>-13.78   </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>         </td>
                  <td>(0.35)   </td>
                </tr>
                <tr>
                  <td>Num.Obs.     </td>
                  <td>15000    </td>
                  <td>15000    </td>
                </tr>
                <tr>
                  <td>Std.Errors   </td>
                  <td>by: state</td>
                  <td>by: state</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>As the model comparison shows, including just the cohort fixed effect here only allows for a ‘level shift’, so it has no impact on the slope for <code>yearc</code> or the product term between <code>treat</code> and <code>yearc</code>. So these models will both produce the same average slopes (though not the same average predictions because of the cohort fixed effect).</p>
<p>What about our slope estimates now?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>m_all_cr_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_cr, </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>m_all_cr_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_cr, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>m_all_cr_slopes <span class="ot">&lt;-</span> m_all_cr_as <span class="sc">%&gt;%</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_cr_slope)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>m_all_crs_as <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_crs, </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>m_all_crs_slope <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_crs, </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>m_all_crs_slopes <span class="ot">&lt;-</span> m_all_crs_as <span class="sc">%&gt;%</span> </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_crs_slope)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"No cohort FE"</span> <span class="ot">=</span> m_all_cr_slopes,</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cohort FE"</span> <span class="ot">=</span> m_all_crs_slopes),</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>,</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Average slopes: restricted relative time model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_rxwe1v5ogiukmy1q4wm4(i, j, css_id) {
        var table = document.getElementById("tinytable_rxwe1v5ogiukmy1q4wm4");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_rxwe1v5ogiukmy1q4wm4');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_rxwe1v5ogiukmy1q4wm4(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_rxwe1v5ogiukmy1q4wm4");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(0, 0, 'tinytable_css_idaehozv8p4jvmcxt13rb0') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(0, 1, 'tinytable_css_idybhjvmyjzrr7ewthbjou') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(0, 2, 'tinytable_css_idybhjvmyjzrr7ewthbjou') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(0, 3, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(0, 4, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(0, 5, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(0, 6, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(1, 0, 'tinytable_css_idi33i0wnus165em0v8esh') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(1, 1, 'tinytable_css_id54qb5kvlm462ydkyu81q') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(1, 2, 'tinytable_css_id54qb5kvlm462ydkyu81q') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(1, 3, 'tinytable_css_id54qb5kvlm462ydkyu81q') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(1, 4, 'tinytable_css_id54qb5kvlm462ydkyu81q') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(1, 5, 'tinytable_css_id54qb5kvlm462ydkyu81q') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(1, 6, 'tinytable_css_id54qb5kvlm462ydkyu81q') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(2, 0, 'tinytable_css_idel9cxvgk1i0uvjf5h4e5') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(2, 1, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(2, 2, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(2, 3, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(2, 4, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(2, 5, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(2, 6, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(3, 0, 'tinytable_css_idel9cxvgk1i0uvjf5h4e5') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(3, 1, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(3, 2, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(3, 3, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(3, 4, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(3, 5, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(3, 6, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(4, 0, 'tinytable_css_idel9cxvgk1i0uvjf5h4e5') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(4, 1, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(4, 2, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(4, 3, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(4, 4, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(4, 5, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
window.addEventListener('load', function () { styleCell_rxwe1v5ogiukmy1q4wm4(4, 6, 'tinytable_css_idbptbrn4nyt44qqnxa6nm') })
    </script>

    <style>
    .table td.tinytable_css_idaehozv8p4jvmcxt13rb0, .table th.tinytable_css_idaehozv8p4jvmcxt13rb0 {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idybhjvmyjzrr7ewthbjou, .table th.tinytable_css_idybhjvmyjzrr7ewthbjou {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idbptbrn4nyt44qqnxa6nm, .table th.tinytable_css_idbptbrn4nyt44qqnxa6nm {  text-align: center; }
    .table td.tinytable_css_idi33i0wnus165em0v8esh, .table th.tinytable_css_idi33i0wnus165em0v8esh {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id54qb5kvlm462ydkyu81q, .table th.tinytable_css_id54qb5kvlm462ydkyu81q {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idel9cxvgk1i0uvjf5h4e5, .table th.tinytable_css_idel9cxvgk1i0uvjf5h4e5 {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_rxwe1v5ogiukmy1q4wm4" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">No cohort FE</th>
<th scope="col" align="center" colspan="3">Cohort FE</th>
</tr>
        </thead><caption>Average slopes: restricted relative time model</caption>
              <tbody><tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        
        
        </tbody><tbody>
                <tr>
                  <td>Pre       </td>
                  <td>1.41 </td>
                  <td>1.25 </td>
                  <td>1.57 </td>
                  <td>1.41 </td>
                  <td>1.25 </td>
                  <td>1.57 </td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td>-0.04</td>
                  <td>-1.59</td>
                  <td>1.50 </td>
                  <td>-0.04</td>
                  <td>-1.59</td>
                  <td>1.50 </td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>-1.45</td>
                  <td>-2.83</td>
                  <td>-0.07</td>
                  <td>-1.45</td>
                  <td>-2.83</td>
                  <td>-0.07</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>The average slope for the model with cohort is -1.45 and the estimate for the model without the cohort term is -1.45. The pre and post slope levels for the restricted relative time models differ due to the cohort term, but both are nearly the same for the estimate we calculated as a weighted average for the full sample using calendar time, which was 2.94.</p>
<p>How about for a fully-interacted model with relative time? Let’s compare it with our model using all of the data above:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>m_all_scri <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> cohort_2015 <span class="sc">*</span> yearc <span class="sc">*</span> treat,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span><span class="fu">subset</span>(ds, yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>), </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Calendar time"</span> <span class="ot">=</span> m_all_int,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Relative time (restricted)"</span> <span class="ot">=</span> m_all_scri), </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_rename =</span> <span class="fu">c</span>(<span class="st">"year0"</span> <span class="ot">=</span> <span class="st">"year"</span>, </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"yearc"</span> <span class="ot">=</span> <span class="st">"year"</span>),</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_yykdxcn0kp0ic2nnuoc6(i, j, css_id) {
        var table = document.getElementById("tinytable_yykdxcn0kp0ic2nnuoc6");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_yykdxcn0kp0ic2nnuoc6');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_yykdxcn0kp0ic2nnuoc6(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_yykdxcn0kp0ic2nnuoc6");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(0, 0, 'tinytable_css_idz9p8fulaaori18715wzo') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(0, 1, 'tinytable_css_id0iaxg6e5icdgow355s7t') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(0, 2, 'tinytable_css_id0iaxg6e5icdgow355s7t') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(1, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(1, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(1, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(2, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(2, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(2, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(3, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(3, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(3, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(4, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(4, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(4, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(5, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(5, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(5, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(6, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(6, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(6, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(7, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(7, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(7, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(8, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(8, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(8, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(9, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(9, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(9, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(10, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(10, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(10, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(11, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(11, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(11, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(12, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(12, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(12, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(13, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(13, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(13, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(14, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(14, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(14, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(15, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(15, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(15, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(16, 0, 'tinytable_css_idd2ps11bbyzlo2qe9cmq2') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(16, 1, 'tinytable_css_id483k5e0tilc4u9c1siar') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(16, 2, 'tinytable_css_id483k5e0tilc4u9c1siar') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(17, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(17, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(17, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(18, 0, 'tinytable_css_id2qrskfq2jfkecfkxt6ps') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(18, 1, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
window.addEventListener('load', function () { styleCell_yykdxcn0kp0ic2nnuoc6(18, 2, 'tinytable_css_idxnkpxs7xj2n8gp54o3xj') })
    </script>

    <style>
    .table td.tinytable_css_idz9p8fulaaori18715wzo, .table th.tinytable_css_idz9p8fulaaori18715wzo {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id0iaxg6e5icdgow355s7t, .table th.tinytable_css_id0iaxg6e5icdgow355s7t {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id2qrskfq2jfkecfkxt6ps, .table th.tinytable_css_id2qrskfq2jfkecfkxt6ps {  text-align: left; }
    .table td.tinytable_css_idxnkpxs7xj2n8gp54o3xj, .table th.tinytable_css_idxnkpxs7xj2n8gp54o3xj {  text-align: center; }
    .table td.tinytable_css_idd2ps11bbyzlo2qe9cmq2, .table th.tinytable_css_idd2ps11bbyzlo2qe9cmq2 {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_id483k5e0tilc4u9c1siar, .table th.tinytable_css_id483k5e0tilc4u9c1siar {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_yykdxcn0kp0ic2nnuoc6" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Calendar time</th>
                <th scope="col">Relative time (restricted)</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)           </td>
                  <td>12.97    </td>
                  <td>31.21    </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.28)   </td>
                  <td>(0.27)   </td>
                </tr>
                <tr>
                  <td>cohort_2015           </td>
                  <td>-0.93    </td>
                  <td>-3.79    </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.36)   </td>
                  <td>(0.34)   </td>
                </tr>
                <tr>
                  <td>year                  </td>
                  <td>2.03     </td>
                  <td>2.03     </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.01)   </td>
                  <td>(0.01)   </td>
                </tr>
                <tr>
                  <td>treat                 </td>
                  <td>-6.44    </td>
                  <td>1.83     </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.12)   </td>
                  <td>(0.12)   </td>
                </tr>
                <tr>
                  <td>cohort_2015:year      </td>
                  <td>-0.93    </td>
                  <td>-0.92    </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.01)   </td>
                  <td>(0.01)   </td>
                </tr>
                <tr>
                  <td>cohort_2015:treat     </td>
                  <td>-45.48   </td>
                  <td>1.49     </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.38)   </td>
                  <td>(0.15)   </td>
                </tr>
                <tr>
                  <td>year:treat            </td>
                  <td>0.92     </td>
                  <td>0.95     </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.01)   </td>
                  <td>(0.03)   </td>
                </tr>
                <tr>
                  <td>cohort_2015:year:treat</td>
                  <td>3.03     </td>
                  <td>2.98     </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.02)   </td>
                  <td>(0.03)   </td>
                </tr>
                <tr>
                  <td>Num.Obs.              </td>
                  <td>20000    </td>
                  <td>15000    </td>
                </tr>
                <tr>
                  <td>Std.Errors            </td>
                  <td>by: state</td>
                  <td>by: state</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>With the fully interacted model using relative time, you get nearly the same slope parameters for year and year * treatment (well within sampling error) since there is no non-linearity in the slopes for either cohort, but the level parameters (intercept, treatment effect at year0, and cohort fixed effect) all will be different. You can then back out predictions for a fixed time post-intervention (e.g., 10 years), but this will obviously lead to extrapolation for the later treated cohort. Nevertheless this shows that the relative time model after eliminating overlap <em>can</em> recover estimates of the true treatment effects.</p>
</section>
<section id="hang-on" class="level2">
<h2 class="anchored" data-anchor-id="hang-on">Hang on…</h2>
<p>The big caveat to the last point above is that this only occurs under specific kinds of scenarios. In particular, the restricted, centered time approach ‘works’ in recovering the true slopes in our prior example because the simulated trends are linear (though not identical across cohorts) in both of the pre- and post-treatment periods. It’s intuitive in the since that, if the trends are linear through the entire time, it shouldn’t matter much whether you use 10 pre-periods or 5 pre-periods to estimate the pre-intervention slope (and vice versa for the post-intervention slope in the early treated cohort).</p>
<p>But this is a strong (and unnecessary) assumption. Plus, if there is non-linearity in the slopes then restricting the analysis to periods of overlap won’t actually help. Let simulate another example. The treatment effects are identical but now we introduce a small amount of non-linearity to the pre-intervention trends for the 2015 cohort.</p>
<p>Here is the code to simulate:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4705</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># unit fixed effects (unobserved heterogeneity)</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>unit <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate clusters</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit_fe =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, state<span class="sc">/</span><span class="dv">10</span>, <span class="dv">1</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate instantaneous treatment effect</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mu = rnorm(nobs, true_mu, 0.2)</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="dv">2</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># year fixed effects (first part)</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2001</span><span class="sc">:</span><span class="dv">2020</span>,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_fe =</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(year), <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Put the clusters into treatment groups</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>treat_taus <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample the clusters randomly</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">30</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>),</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># place the randomly sampled states into 1\{t \ge g \}G_g</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">cohort_year =</span> <span class="fu">sort</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2010</span>, <span class="dv">2015</span>), <span class="at">times=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>)))</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># make main dataset</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co"># full interaction of unit X year </span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>dtest2 <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">year =</span> <span class="dv">2001</span><span class="sc">:</span><span class="dv">2020</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., unit) <span class="sc">%&gt;%</span> </span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., year) <span class="sc">%&gt;%</span> </span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., treat_taus) <span class="sc">%&gt;%</span> </span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make error term and get treatment indicators and treatment effects</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Also get cohort specific trends (modify time FE)</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">error =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span><span class="sc">*</span><span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat =</span> <span class="fu">ifelse</span>((year <span class="sc">&gt;=</span> </span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>           cohort_year), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>         <span class="co"># treatment effect = 4 if 2015, 1 if 2010, annually</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">mu =</span> <span class="fu">ifelse</span>(cohort_year<span class="sc">==</span><span class="dv">2015</span>, <span class="dv">4</span>, <span class="dv">1</span>),</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">tau =</span> <span class="fu">ifelse</span>(treat <span class="sc">==</span> <span class="dv">1</span>, mu, <span class="dv">0</span>),</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>         <span class="co"># year trends differ by cohort</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_fe =</span> <span class="fu">ifelse</span>(cohort_year<span class="sc">==</span><span class="dv">2015</span> <span class="sc">&amp;</span> year<span class="sc">&lt;</span><span class="dv">2006</span>,</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>          year_fe <span class="sc">+</span> (<span class="dv">2015</span> <span class="sc">-</span> cohort_year) <span class="sc">*</span> </span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>           (year <span class="sc">-</span> cohort_year) <span class="sc">/</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">12</span>,</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>          year_fe <span class="sc">+</span> (<span class="dv">2020</span> <span class="sc">-</span> cohort_year) <span class="sc">*</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>           (year <span class="sc">-</span> cohort_year) <span class="sc">/</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">20</span>)</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate cumulative treatment effects</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(unit) <span class="sc">%&gt;%</span> </span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tau_cum =</span> <span class="fu">cumsum</span>(tau)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the dependent variable</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> (<span class="dv">2020</span> <span class="sc">-</span> cohort_year) <span class="sc">+</span> </span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>           unit_fe <span class="sc">+</span> year_fe <span class="sc">+</span> tau_cum <span class="sc">+</span> error) </span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co"># bring in simulated DiD dataset</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>dss <span class="ot">&lt;-</span> dtest2 <span class="sc">%&gt;%</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read_rds(here("data", </span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a> <span class="co">#"did-sim-data.rds")) %&gt;%</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year0 =</span> year <span class="sc">-</span> <span class="dv">2001</span>,</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">yearc =</span> year <span class="sc">-</span> cohort_year,</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">cohort_2015 =</span> <span class="fu">ifelse</span>(cohort_year <span class="sc">==</span> <span class="dv">2015</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is our new plot:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dss <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year0, <span class="at">y =</span> y, <span class="at">group =</span> unit)) <span class="sc">+</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dss <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cohort_year, year0) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">mean</span>(y)),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">aes</span>(<span class="at">x =</span> year0, <span class="at">y =</span> y, <span class="at">group =</span> <span class="fu">factor</span>(cohort_year),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">factor</span>(cohort_year)), <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dss <span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year0) <span class="sc">%&gt;%</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">mean</span>(y)),</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year0, <span class="at">y =</span> y, <span class="at">color =</span> <span class="st">"#4daf4a"</span>, <span class="at">group=</span><span class="st">"All"</span>), </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Y"</span>,  <span class="at">color =</span> <span class="st">"Treatment group   "</span>) <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">'#E41A1C'</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">15</span>, <span class="at">color =</span> <span class="st">'#377EB8'</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">'Set1'</span>, </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"2010"</span>, <span class="st">"2015"</span>, <span class="st">"Average"</span>)) <span class="sc">+</span> </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="its-sim_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this particular scenario, the non-linear part of the trend for the 2015 cohort is in the very early pre-period (everything else is the same), which means it won’t be captured when we have to restrict to years of overlap when using relative time. Here is a plot using relative time:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dss <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> yearc, <span class="at">y =</span> y, <span class="at">group =</span> unit)) <span class="sc">+</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> ds <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cohort_year, yearc) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">mean</span>(y)),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">aes</span>(<span class="at">x =</span> yearc, <span class="at">y =</span> y, <span class="at">group =</span> <span class="fu">factor</span>(cohort_year),</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">factor</span>(cohort_year)), <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> ds <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(yearc) <span class="sc">%&gt;%</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">mean</span>(y)),</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> yearc, <span class="at">y =</span> y, <span class="at">color =</span> <span class="st">"#4daf4a"</span>, <span class="at">group=</span><span class="st">"All"</span>), </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Y"</span>,  <span class="at">color =</span> <span class="st">"Treatment group   "</span>) <span class="sc">+</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'#984ea3'</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">'Set1'</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"2010"</span>, <span class="st">"2015"</span>, <span class="st">"Average"</span>)) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="its-sim_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This looks a lot like the plot from our earlier simulation. We won’t go through all of the prior models, but let’s compare what we get from the interactive analysis using calendar time, as well as the simple model using restricted time, which we saw gave us the correct slope in the example above. Here are the models and parameters:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calendar time full model</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>m_all_int2 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> cohort_2015 <span class="sc">*</span> year0 <span class="sc">*</span> treat,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dss, <span class="at">clusters =</span> state)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># relative time full model</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>m_all_scri2 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> cohort_2015 <span class="sc">*</span> yearc <span class="sc">*</span> treat,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span><span class="fu">subset</span>(dss, yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>), </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># relative time basic model</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>m_all_cr2 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> yearc <span class="sc">*</span> treat,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span><span class="fu">subset</span>(dss, yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>), </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># relative time basic model</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>m_all_crs2 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> cohort_2015 <span class="sc">+</span> yearc <span class="sc">*</span> treat,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span><span class="fu">subset</span>(dss, yearc <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">9</span> <span class="sc">&amp;</span> yearc <span class="sc">&lt;=</span> <span class="dv">5</span>), </span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> state)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Calendar time"</span> <span class="ot">=</span> m_all_int2,</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Relative time (restricted)"</span> <span class="ot">=</span> m_all_scri2,</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Basic model (restricted)"</span> <span class="ot">=</span> m_all_cr2), </span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">coef_rename =</span> <span class="fu">c</span>(<span class="st">"year0"</span> <span class="ot">=</span> <span class="st">"year"</span>, </span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"yearc"</span> <span class="ot">=</span> <span class="st">"year"</span>),</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_830comjcusd0lhmhe4vr(i, j, css_id) {
        var table = document.getElementById("tinytable_830comjcusd0lhmhe4vr");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_830comjcusd0lhmhe4vr');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_830comjcusd0lhmhe4vr(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_830comjcusd0lhmhe4vr");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(0, 0, 'tinytable_css_id0v3pjk0tsyaokbwd8tso') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(0, 1, 'tinytable_css_id6r2p7v4js0xiy3i6kjql') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(0, 2, 'tinytable_css_id6r2p7v4js0xiy3i6kjql') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(0, 3, 'tinytable_css_id6r2p7v4js0xiy3i6kjql') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(1, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(1, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(1, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(1, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(2, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(2, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(2, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(2, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(3, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(3, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(3, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(3, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(4, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(4, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(4, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(4, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(5, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(5, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(5, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(5, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(6, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(6, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(6, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(6, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(7, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(7, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(7, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(7, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(8, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(8, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(8, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(8, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(9, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(9, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(9, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(9, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(10, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(10, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(10, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(10, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(11, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(11, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(11, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(11, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(12, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(12, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(12, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(12, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(13, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(13, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(13, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(13, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(14, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(14, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(14, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(14, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(15, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(15, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(15, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(15, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(16, 0, 'tinytable_css_idrt8u3onpyd9gjmznpdrm') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(16, 1, 'tinytable_css_id84pbdev5a9zkmmxywmor') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(16, 2, 'tinytable_css_id84pbdev5a9zkmmxywmor') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(16, 3, 'tinytable_css_id84pbdev5a9zkmmxywmor') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(17, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(17, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(17, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(17, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(18, 0, 'tinytable_css_idm4m0amln3yxmci936m7e') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(18, 1, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(18, 2, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
window.addEventListener('load', function () { styleCell_830comjcusd0lhmhe4vr(18, 3, 'tinytable_css_id4hprbcrbwzpt6m1d181d') })
    </script>

    <style>
    .table td.tinytable_css_id0v3pjk0tsyaokbwd8tso, .table th.tinytable_css_id0v3pjk0tsyaokbwd8tso {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id6r2p7v4js0xiy3i6kjql, .table th.tinytable_css_id6r2p7v4js0xiy3i6kjql {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idm4m0amln3yxmci936m7e, .table th.tinytable_css_idm4m0amln3yxmci936m7e {  text-align: left; }
    .table td.tinytable_css_id4hprbcrbwzpt6m1d181d, .table th.tinytable_css_id4hprbcrbwzpt6m1d181d {  text-align: center; }
    .table td.tinytable_css_idrt8u3onpyd9gjmznpdrm, .table th.tinytable_css_idrt8u3onpyd9gjmznpdrm {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_id84pbdev5a9zkmmxywmor, .table th.tinytable_css_id84pbdev5a9zkmmxywmor {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_830comjcusd0lhmhe4vr" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Calendar time</th>
                <th scope="col">Relative time (restricted)</th>
                <th scope="col">Basic model (restricted)</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)           </td>
                  <td>13.72    </td>
                  <td>32.08    </td>
                  <td>27.79    </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.39)   </td>
                  <td>(0.36)   </td>
                  <td>(0.59)   </td>
                </tr>
                <tr>
                  <td>cohort_2015           </td>
                  <td>3.32     </td>
                  <td>-6.38    </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.42)   </td>
                  <td>(0.41)   </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>year                  </td>
                  <td>2.04     </td>
                  <td>2.04     </td>
                  <td>1.26     </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.01)   </td>
                  <td>(0.01)   </td>
                  <td>(0.10)   </td>
                </tr>
                <tr>
                  <td>treat                 </td>
                  <td>-9.02    </td>
                  <td>-0.07    </td>
                  <td>3.44     </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.11)   </td>
                  <td>(0.10)   </td>
                  <td>(0.47)   </td>
                </tr>
                <tr>
                  <td>cohort_2015:year      </td>
                  <td>-1.53    </td>
                  <td>-1.16    </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.01)   </td>
                  <td>(0.02)   </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>cohort_2015:treat     </td>
                  <td>-45.09   </td>
                  <td>5.22     </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.32)   </td>
                  <td>(0.13)   </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>year:treat            </td>
                  <td>1.01     </td>
                  <td>1.04     </td>
                  <td>3.01     </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.01)   </td>
                  <td>(0.02)   </td>
                  <td>(0.26)   </td>
                </tr>
                <tr>
                  <td>cohort_2015:year:treat</td>
                  <td>3.34     </td>
                  <td>2.94     </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>                      </td>
                  <td>(0.02)   </td>
                  <td>(0.03)   </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>Num.Obs.              </td>
                  <td>20000    </td>
                  <td>15000    </td>
                  <td>15000    </td>
                </tr>
                <tr>
                  <td>Std.Errors            </td>
                  <td>by: state</td>
                  <td>by: state</td>
                  <td>by: state</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>We can see that the basic model with restricted time has a different <code>year x treat</code> term, and the interactive model has a different value for the 3-way interaction between cohort, year, and treatment.</p>
<p>What is the true slope here?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cohort-specific treatment effects</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>m_all_int_aas2 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_int2, <span class="at">variable =</span> <span class="st">"year0"</span>, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>), </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="fu">c</span>(<span class="st">"b2 - b1 = 0"</span>, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">"b4 - b3 = 0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"2010 cohort"</span>, <span class="st">"2015 cohort"</span>))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># weighted average of treatment slopes</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>m_all_int_slope2 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_int2, </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="st">"year0"</span>, </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>), </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"(1/3)*(b2 - b1) + (2/3)*(b4 - b3) = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Average slope"</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>m_all_int_aslope2 <span class="ot">&lt;-</span> m_all_int_aas2 <span class="sc">%&gt;%</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_int_slope2)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Population average slope: interaction model"</span> </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>                  <span class="ot">=</span> m_all_int_aslope2), <span class="at">fmt =</span> <span class="dv">2</span>,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> statistic,</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>,</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">notes =</span> <span class="st">"Note: 2015 cohort weighted by 2/3."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_7m2vp2cj1a5mlsoamwxl(i, j, css_id) {
        var table = document.getElementById("tinytable_7m2vp2cj1a5mlsoamwxl");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_7m2vp2cj1a5mlsoamwxl');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_7m2vp2cj1a5mlsoamwxl(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_7m2vp2cj1a5mlsoamwxl");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(0, 0, 'tinytable_css_idsvw76sfcdar48d0ypq2l') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(0, 1, 'tinytable_css_idk4o5trfl9utln81s0np5') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(0, 2, 'tinytable_css_idjkcbhn6cbh0zbwufiq2y') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(0, 3, 'tinytable_css_idjkcbhn6cbh0zbwufiq2y') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(1, 0, 'tinytable_css_idf0inldrnuuocmvkcpff6') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(1, 1, 'tinytable_css_idebfih9e4fo59vgfpya29') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(1, 2, 'tinytable_css_idebfih9e4fo59vgfpya29') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(1, 3, 'tinytable_css_idebfih9e4fo59vgfpya29') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(2, 0, 'tinytable_css_idfeddnxa2rz97vp355sib') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(2, 1, 'tinytable_css_idjkcbhn6cbh0zbwufiq2y') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(2, 2, 'tinytable_css_idjkcbhn6cbh0zbwufiq2y') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(2, 3, 'tinytable_css_idjkcbhn6cbh0zbwufiq2y') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(3, 0, 'tinytable_css_idfeddnxa2rz97vp355sib') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(3, 1, 'tinytable_css_idjkcbhn6cbh0zbwufiq2y') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(3, 2, 'tinytable_css_idjkcbhn6cbh0zbwufiq2y') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(3, 3, 'tinytable_css_idjkcbhn6cbh0zbwufiq2y') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(4, 0, 'tinytable_css_idfeddnxa2rz97vp355sib') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(4, 1, 'tinytable_css_idjkcbhn6cbh0zbwufiq2y') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(4, 2, 'tinytable_css_idjkcbhn6cbh0zbwufiq2y') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(4, 3, 'tinytable_css_idjkcbhn6cbh0zbwufiq2y') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(5, 0, 'tinytable_css_idfeddnxa2rz97vp355sib') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(5, 1, 'tinytable_css_idfeddnxa2rz97vp355sib') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(5, 2, 'tinytable_css_idfeddnxa2rz97vp355sib') })
window.addEventListener('load', function () { styleCell_7m2vp2cj1a5mlsoamwxl(5, 3, 'tinytable_css_idfeddnxa2rz97vp355sib') })
    </script>

    <style>
    .table td.tinytable_css_idsvw76sfcdar48d0ypq2l, .table th.tinytable_css_idsvw76sfcdar48d0ypq2l {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idk4o5trfl9utln81s0np5, .table th.tinytable_css_idk4o5trfl9utln81s0np5 {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idjkcbhn6cbh0zbwufiq2y, .table th.tinytable_css_idjkcbhn6cbh0zbwufiq2y {  text-align: center; }
    .table td.tinytable_css_idf0inldrnuuocmvkcpff6, .table th.tinytable_css_idf0inldrnuuocmvkcpff6 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idebfih9e4fo59vgfpya29, .table th.tinytable_css_idebfih9e4fo59vgfpya29 {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idfeddnxa2rz97vp355sib, .table th.tinytable_css_idfeddnxa2rz97vp355sib {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_7m2vp2cj1a5mlsoamwxl" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Population average slope: interaction model</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="4">Note: 2015 cohort weighted by 2/3.</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>2010 cohort  </td>
                  <td>1.01</td>
                  <td>0.98</td>
                  <td>1.04</td>
                </tr>
                <tr>
                  <td>2015 cohort  </td>
                  <td>4.35</td>
                  <td>4.31</td>
                  <td>4.38</td>
                </tr>
                <tr>
                  <td>Average slope</td>
                  <td>3.23</td>
                  <td>3.21</td>
                  <td>3.26</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Okay, so introducing this bit of non-linearity in the early years flattens the pre-intervention slope for the 2015 cohort, so the treatment effect is also a little larger (3.23) relative to the previously simulated data (2.94).</p>
<p>Above we saw that when using relative time and limiting the data to years of overlap even the simple models with or without a fixed effect for cohort could recover the weighted average treatment slope from the calendar time model. What do we get now?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>m_all_cr_as2 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_cr2, </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>m_all_cr_slope2 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_cr2, </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>m_all_cr_slopes2 <span class="ot">&lt;-</span> m_all_cr_as2 <span class="sc">%&gt;%</span> </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_cr_slope2)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>m_all_crs_as2 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_crs2, </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>))</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>m_all_crs_slope2 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_crs2, </span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"yearc"</span>, <span class="at">by=</span><span class="st">"treat"</span>,</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Difference"</span>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>m_all_crs_slopes2 <span class="ot">&lt;-</span> m_all_crs_as2 <span class="sc">%&gt;%</span> </span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_crs_slope2)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"No cohort FE"</span> <span class="ot">=</span> m_all_cr_slopes2,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cohort FE"</span> <span class="ot">=</span> m_all_crs_slopes2),</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>,</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Average slopes: restricted relative time model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_1h7qdepjhfuicin3khd5(i, j, css_id) {
        var table = document.getElementById("tinytable_1h7qdepjhfuicin3khd5");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_1h7qdepjhfuicin3khd5');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_1h7qdepjhfuicin3khd5(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_1h7qdepjhfuicin3khd5");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(0, 0, 'tinytable_css_idxj3b5fjs928zyhvye7kt') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(0, 1, 'tinytable_css_idbinc8b5bm924qhvfu6m2') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(0, 2, 'tinytable_css_idbinc8b5bm924qhvfu6m2') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(0, 3, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(0, 4, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(0, 5, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(0, 6, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(1, 0, 'tinytable_css_id8f8mh9ij4eiu76e3k96p') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(1, 1, 'tinytable_css_iddormm17p4n25n0jrgi9l') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(1, 2, 'tinytable_css_iddormm17p4n25n0jrgi9l') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(1, 3, 'tinytable_css_iddormm17p4n25n0jrgi9l') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(1, 4, 'tinytable_css_iddormm17p4n25n0jrgi9l') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(1, 5, 'tinytable_css_iddormm17p4n25n0jrgi9l') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(1, 6, 'tinytable_css_iddormm17p4n25n0jrgi9l') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(2, 0, 'tinytable_css_id4e8ke128cnjqamfjj18j') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(2, 1, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(2, 2, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(2, 3, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(2, 4, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(2, 5, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(2, 6, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(3, 0, 'tinytable_css_id4e8ke128cnjqamfjj18j') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(3, 1, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(3, 2, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(3, 3, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(3, 4, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(3, 5, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(3, 6, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(4, 0, 'tinytable_css_id4e8ke128cnjqamfjj18j') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(4, 1, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(4, 2, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(4, 3, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(4, 4, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(4, 5, 'tinytable_css_idh1vo32r5w1i2inadski9') })
window.addEventListener('load', function () { styleCell_1h7qdepjhfuicin3khd5(4, 6, 'tinytable_css_idh1vo32r5w1i2inadski9') })
    </script>

    <style>
    .table td.tinytable_css_idxj3b5fjs928zyhvye7kt, .table th.tinytable_css_idxj3b5fjs928zyhvye7kt {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idbinc8b5bm924qhvfu6m2, .table th.tinytable_css_idbinc8b5bm924qhvfu6m2 {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idh1vo32r5w1i2inadski9, .table th.tinytable_css_idh1vo32r5w1i2inadski9 {  text-align: center; }
    .table td.tinytable_css_id8f8mh9ij4eiu76e3k96p, .table th.tinytable_css_id8f8mh9ij4eiu76e3k96p {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_iddormm17p4n25n0jrgi9l, .table th.tinytable_css_iddormm17p4n25n0jrgi9l {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id4e8ke128cnjqamfjj18j, .table th.tinytable_css_id4e8ke128cnjqamfjj18j {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_1h7qdepjhfuicin3khd5" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">No cohort FE</th>
<th scope="col" align="center" colspan="3">Cohort FE</th>
</tr>
        </thead><caption>Average slopes: restricted relative time model</caption>
              <tbody><tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        
        
        </tbody><tbody>
                <tr>
                  <td>Pre       </td>
                  <td>1.26</td>
                  <td>1.06</td>
                  <td>1.46</td>
                  <td>1.26</td>
                  <td>1.06</td>
                  <td>1.46</td>
                </tr>
                <tr>
                  <td>Post      </td>
                  <td>4.27</td>
                  <td>3.96</td>
                  <td>4.58</td>
                  <td>4.27</td>
                  <td>3.96</td>
                  <td>4.58</td>
                </tr>
                <tr>
                  <td>Difference</td>
                  <td>3.01</td>
                  <td>2.50</td>
                  <td>3.52</td>
                  <td>3.01</td>
                  <td>2.50</td>
                  <td>3.52</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>As above we get the same answer regardless of whether or not we include cohort fixed effects. However the average slope here is 3.01, which is biased downward relative to the true effect of 3.23. This is precisely because the pre-intervention slope of the restricted relative time model does not account for the diminished slope of the 2015 cohort in the early pre-period.</p>
<p>What about if we use the fully interacted model with restricted relative time?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cohort-specific treatment effects</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>m_all_scri_aas2 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_scri2, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="st">"yearc"</span>, </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>), </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="fu">c</span>(<span class="st">"b2 - b1 = 0"</span>, </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>   <span class="st">"b4 - b3 = 0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"2010 cohort"</span>, <span class="st">"2015 cohort"</span>))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># weighted average of treatment slopes</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>m_all_scri_slope2 <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(m_all_scri2, </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="st">"yearc"</span>, </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"cohort_2015"</span>, <span class="st">"treat"</span>), </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">hypothesis =</span> <span class="st">"(1/3)*(b2 - b1) + (2/3)*(b4 - b3) = 0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="st">"Average slope"</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>m_all_scri_aslope2 <span class="ot">&lt;-</span> m_all_scri_aas2 <span class="sc">%&gt;%</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m_all_scri_slope2)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Calender time"</span> <span class="ot">=</span> m_all_int_aslope2,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Relative (restricted) time"</span> <span class="ot">=</span> m_all_scri_aslope2),</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">statistic =</span> <span class="st">"conf.int"</span>, </span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> term <span class="sc">~</span> model <span class="sc">+</span> statistic,</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|RMSE'</span>,</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">notes =</span> <span class="st">"Note: 2015 cohort weighted by 2/3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_n1yjjs56wej09ptz09oa(i, j, css_id) {
        var table = document.getElementById("tinytable_n1yjjs56wej09ptz09oa");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_n1yjjs56wej09ptz09oa');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_n1yjjs56wej09ptz09oa(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_n1yjjs56wej09ptz09oa");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(0, 0, 'tinytable_css_id935k5ayl4ymd567fxbk9') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(0, 1, 'tinytable_css_idvjgmoo8po74pacy2i6aq') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(0, 2, 'tinytable_css_idvjgmoo8po74pacy2i6aq') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(0, 3, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(0, 4, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(0, 5, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(0, 6, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(1, 0, 'tinytable_css_idn29kg2nw9ynlur9mjnga') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(1, 1, 'tinytable_css_idc291ojuj8apynit0za9h') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(1, 2, 'tinytable_css_idc291ojuj8apynit0za9h') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(1, 3, 'tinytable_css_idc291ojuj8apynit0za9h') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(1, 4, 'tinytable_css_idc291ojuj8apynit0za9h') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(1, 5, 'tinytable_css_idc291ojuj8apynit0za9h') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(1, 6, 'tinytable_css_idc291ojuj8apynit0za9h') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(2, 0, 'tinytable_css_idzxklf022gnpiuepn5hm5') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(2, 1, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(2, 2, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(2, 3, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(2, 4, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(2, 5, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(2, 6, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(3, 0, 'tinytable_css_idzxklf022gnpiuepn5hm5') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(3, 1, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(3, 2, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(3, 3, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(3, 4, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(3, 5, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(3, 6, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(4, 0, 'tinytable_css_idzxklf022gnpiuepn5hm5') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(4, 1, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(4, 2, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(4, 3, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(4, 4, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(4, 5, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(4, 6, 'tinytable_css_idxysrks8g84wvz7m7s3yb') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(5, 0, 'tinytable_css_idzxklf022gnpiuepn5hm5') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(5, 1, 'tinytable_css_idzxklf022gnpiuepn5hm5') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(5, 2, 'tinytable_css_idzxklf022gnpiuepn5hm5') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(5, 3, 'tinytable_css_idzxklf022gnpiuepn5hm5') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(5, 4, 'tinytable_css_idzxklf022gnpiuepn5hm5') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(5, 5, 'tinytable_css_idzxklf022gnpiuepn5hm5') })
window.addEventListener('load', function () { styleCell_n1yjjs56wej09ptz09oa(5, 6, 'tinytable_css_idzxklf022gnpiuepn5hm5') })
    </script>

    <style>
    .table td.tinytable_css_id935k5ayl4ymd567fxbk9, .table th.tinytable_css_id935k5ayl4ymd567fxbk9 {  text-align: center;  text-align: left; }
    .table td.tinytable_css_idvjgmoo8po74pacy2i6aq, .table th.tinytable_css_idvjgmoo8po74pacy2i6aq {  text-align: center;  border-bottom: solid 0.05em #d3d8dc; }
    .table td.tinytable_css_idxysrks8g84wvz7m7s3yb, .table th.tinytable_css_idxysrks8g84wvz7m7s3yb {  text-align: center; }
    .table td.tinytable_css_idn29kg2nw9ynlur9mjnga, .table th.tinytable_css_idn29kg2nw9ynlur9mjnga {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idc291ojuj8apynit0za9h, .table th.tinytable_css_idc291ojuj8apynit0za9h {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idzxklf022gnpiuepn5hm5, .table th.tinytable_css_idzxklf022gnpiuepn5hm5 {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_n1yjjs56wej09ptz09oa" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="3">Calender time</th>
<th scope="col" align="center" colspan="3">Relative (restricted) time</th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
                <th scope="col">Est.</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="7">Note: 2015 cohort weighted by 2/3</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>2010 cohort  </td>
                  <td>1.01</td>
                  <td>0.98</td>
                  <td>1.04</td>
                  <td>1.04</td>
                  <td>0.99</td>
                  <td>1.08</td>
                </tr>
                <tr>
                  <td>2015 cohort  </td>
                  <td>4.35</td>
                  <td>4.31</td>
                  <td>4.38</td>
                  <td>3.97</td>
                  <td>3.94</td>
                  <td>4.01</td>
                </tr>
                <tr>
                  <td>Average slope</td>
                  <td>3.23</td>
                  <td>3.21</td>
                  <td>3.26</td>
                  <td>2.99</td>
                  <td>2.97</td>
                  <td>3.02</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Here, even the interacted model that allows for separate treatment effects by cohort does not recover the true slope. Again, you can see the main issue is the fact that the average slope for the 2015 cohort is biased downward. Obviously this latter simulation does not introduce a lot of non-linearity in the pre-trends, but even a small amount leads to bias when using relative time.</p>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Note this model is set up slightly differently than an ITS where the product term uses the ‘time-since intervention’. It’s easier to estimate marginal effects when both variables in the product term are in the model, but the downside is that the coefficient on <code>treat</code> now does not directly give us the step change at the time of the intervention. That can be easily done via marginal predictions.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>